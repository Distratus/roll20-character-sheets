<!--Is the Sheet for the Player or GM?-->
<input type="radio" name="attr_gmdicepool" class="sheet-player" value="1" checked="checked" style="display:none">
<input type="radio" name="attr_gmdicepool" class="sheet-gm" value="2" style="display:none">
    <input type="hidden" name="attr_typeInitiativeMod" value="0"/>
    <input type="hidden" name="attr_typeDamageMod" value="0"/>
    <input type="hidden" name="attr_classTravelMod" value="0"/>
    <input type="hidden" name="attr_classDirectionMod" value="0"/>
    <input type="hidden" name="attr_classCampMod" value="0"/>
    <input type="hidden" name="attr_classConditionMod" value="0"/>
    <input type="hidden" name="attr_classNegotiationMod" value="0"/>
    <input type="hidden" name="attr_classeEncMod" value="0"/>
    <input type="hidden" name="attr_classSkillBonus" value="0"/>
    <input type="hidden" name="attr_armorPenalty" value="0"/>
    <input type="hidden" name="attr_concentrationBonus" value="0"/>
    <input type="hidden" name="attr_speciesConditionMod" value="0"/>
    <input type="hidden" name="attr_speciesInitiativeMod" value="0"/>
    <input type="hidden" name="attr_EquipEncTotal" value="0"/>
    <input type="hidden" name="attr_EquipConteEncTotal" value="0"/>
    <input type="hidden" name="attr_armeEncTotal" value="0"/>
    <input type="hidden" name="attr_armureEncTotal" value="0"/>
    <input type="hidden" name="attr_MalusEnc" value="0"/>
    <input type="hidden" name="attr_TypeEncMod" value="0"/>
    <input type="hidden" name="attr_TypePVMod" value="0"/>
    <input type="hidden" name="attr_TypePEMod" value="0"/>
    <input type="hidden" name="attr_EquipAnimal1EncTotal" value="0"/>
    <input type="hidden" name="attr_EquipAnimal1Contenant1EncTotal" value="0"/>
    <input type="hidden" name="attr_EquipAnimal1Contenant2EncTotal" value="0"/>
    <input type="hidden" name="attr_EquipAnimal1Contenant3EncTotal" value="0"/>
    <input type="hidden" name="attr_EquipAnimal2EncTotal" value="0"/>
    <input type="hidden" name="attr_EquipAnimal2Contenant1EncTotal" value="0"/>
    <input type="hidden" name="attr_EquipAnimal2Contenant2EncTotal" value="0"/>
    <input type="hidden" name="attr_EquipAnimal2Contenant3EncTotal" value="0"/>
    <input type="hidden" name="attr_EquipAnimal3EncTotal" value="0"/>
    <input type="hidden" name="attr_EquipAnimal3Contenant1EncTotal" value="0"/>
    <input type="hidden" name="attr_EquipAnimal3Contenant2EncTotal" value="0"/>
    <input type="hidden" name="attr_EquipAnimal3Contenant3EncTotal" value="0"/>
    <input type="hidden" name="attr_EquipAnimal4EncTotal" value="0"/>
    <input type="hidden" name="attr_EquipAnimal4Contenant1EncTotal" value="0"/>
    <input type="hidden" name="attr_EquipAnimal4Contenant2EncTotal" value="0"/>
    <input type="hidden" name="attr_EquipAnimal4Contenant3EncTotal" value="0"/>
    <input type="hidden" name="attr_EquipAnimal5EncTotal" value="0"/>
    <input type="hidden" name="attr_EquipAnimal5Contenant1EncTotal" value="0"/>
    <input type="hidden" name="attr_EquipAnimal5Contenant2EncTotal" value="0"/>
    <input type="hidden" name="attr_EquipAnimal5Contenant3EncTotal" value="0"/>
    <input type="hidden" name="attr_affDragNiv2" value="0"/>
    <input type="hidden" name="attr_affDragNiv3" value="0"/>
    <input type="hidden" name="attr_affDragNiv4" value="0"/>
    <input type="hidden" name="attr_affDragNiv5" value="0"/>
    <input type="hidden" name="attr_affMagie2" value="0"/>
    <input type="hidden" name="attr_affNiv2" value="0"/>
    <input type="hidden" name="attr_affNiv3" value="0"/>
    <input type="hidden" name="attr_affNiv4" value="0"/>
    <input type="hidden" name="attr_affNiv5" value="0"/>
    <input type="hidden" name="attr_affNiv6" value="0"/>
    <input type="hidden" name="attr_affNiv7" value="0"/>
    <input type="hidden" name="attr_affNiv8" value="0"/>
    <input type="hidden" name="attr_affNiv9" value="0"/>
    <input type="hidden" name="attr_affNiv10" value="0"/>
    <input type="hidden" name="attr_AffCrea" value="0"/>
    <input type="hidden" name="attr_AffCuis" value="0"/>
    <input type="hidden" name="attr_MAAffCrea" value="0"/>
    <input type="hidden" name="attr_MAAffCuis" value="0"/>
    <input type="hidden" name="attr_MAAffCreaT" value="0"/>
    <input type="hidden" name="attr_MAAffCuisT" value="0"/>
    <input type="hidden" name="attr_MATrans" value="0"/>
    <input type="hidden" name="attr_MARepa" value="0"/>
    <input type="hidden" name="attr_MAChasse" value="0"/>
    <input type="hidden" name="attr_MACrea" value="0"/>
    <input type="hidden" name="attr_MATraque" value="0"/>
    <input type="hidden" name="attr_MAEli" value="0"/>
    <input type="hidden" name="attr_MAHerbe" value="0"/>
    <input type="hidden" name="attr_MASoins" value="0"/>
    <input type="hidden" name="attr_MAComm" value="0"/>
    <input type="hidden" name="attr_MALeg" value="0"/>
    <input type="hidden" name="attr_MAMelo" value="0"/>
    <input type="hidden" name="attr_MANavi" value="0"/>
    <input type="hidden" name="attr_MAEru" value="0"/>
    <input type="hidden" name="attr_MAEti" value="0"/>
    <input type="hidden" name="attr_RaceEncMod" value="0"/>
    <input type="hidden" name="attr_BonusSaisonKoneko" value="0"/>
    <input type="hidden" name="attr_Vit5" value="0"/>
    <input type="hidden" name="attr_Vit10" value="0"/>
    <input type="hidden" name="attr_injured" value="2"/>
    <input type="hidden" name="attr_poisoned" value="2"/>
    <input type="hidden" name="attr_sick" value="2"/>
    <input type="hidden" name="attr_exhausted" value="2"/>
    <input type="hidden" name="attr_muddled" value="2"/>
    <input type="hidden" name="attr_shocked" value="2"/>
    
<!--Player Sheet Tabs-->
<div class="tabs">
    <input type="radio" name="attr_pcgm" class="sheet-tab-new" value="personange" checked="checked" /><span data-i18n="personange">Personnage</span>
    <input type="radio" name="attr_pcgm" class="sheet-tab-new" value="monstre" /><span data-i18n="monstre">Monstre</span>
    <input type="radio" name="attr_pcgm" class="sheet-tab-new" value="gm" /><span data-i18n="homme-dragon">Homme-dragon</span>
</div>
<input type="hidden" name="attr_pcgm" class="sheet-player-sheet" value="personange"><!-- Above Radio Buttons toggle this input -->

<div class="sheet-tab-content sheet-tab-npc-sheet">
    <div class="sheet-4colrow">
        <div class="sheet-col">
            <div class="sheet-panneau">
                <span class="thead" data-i18n="ptsdevie">Pts de Vie</span>
                    <input name="attr_PV" type="number" min="-20" value="0" />;
                    <input name="attr_PVmax-monstre" type="number" value="0" /><br />
                <label class="sheet-label-casedroite" data-i18n="actuel">Actuel</label>
                <label class="sheet-label-casegauche" data-i18n="max-p">Max.</label>
            </div>
            <div class="sheet-panneau">
                <span class="thead" data-i18n="initiative">Initiative</span>
                    <input type="number" name="attr_Initiative-Monstre" value="0" />
                    <button class="sheet-btn" type="roll" value="&{template:base} {{Init=Initiative}} {{Perso=@{character_name}}} {{die1=[[@{Initiative-Monstre} &{tracker}]]}}"></button>
            </div>
        </div>
        <div class="sheet-col">
            <div class="sheet-panneau">
                <span class="thead" data-i18n="ptsdenergie">Pts d'Énergie</span>
                    <input name="attr_PE" type="number" min="0" value="0" />;
                    <input name="attr_PEmax-monstre" type="number" value="0"  /><br />
                <label class="sheet-label-casedroite" data-i18n="actuel">Actuel</label>
                <label class="sheet-label-casegauche" data-i18n="max-p">Max.</label>
            </div>
            <div class="sheet-panneau">
                <span class="thead" data-i18n="precision">Précision</span>
                <select name="attr_Pre1monstre">                
                    <option value="4" data-i18n="d4">d4</option>
                    <option value="6" data-i18n="d6">d6</option>
                    <option value="8" data-i18n="d8">d8</option>
                    <option value="10" data-i18n="d10">d10</option>
                    <option value="12" data-i18n="d12">d12</option>
                </select>
                <button class="sheet-btn" type="roll" value="&{template:base} {{Test=Attaque}} {{Perso=@{character_name}}} {{die1=[[1d@{Pre1monstre}]]}} {{die2=[[1d@{Pre1monstre}]]}} {{Mod=[[0]]}} {{Dgt=[[1d@{Dgt-monstre}]]}}  {{Dgtcrit=[[1d@{Dgt-monstre}]]}} {{Attaque=1}}"></button>
                <select name="attr_Pre2monstre">                
                    <option value="4" data-i18n="d4">d4</option>
                    <option value="6" data-i18n="d6">d6</option>
                    <option value="8" data-i18n="d8">d8</option>
                    <option value="10" data-i18n="d10">d10</option>
                    <option value="12" data-i18n="d12">d12</option>
                </select>
            </div>
        </div>
        <div class="sheet-col">
            <div class="sheet-panneau">
                <span class="thead" data-i18n="condition">Condition</span>
                <input name="attr_condition" type="number" min="0" max="20" value="0" />;
                <input name="attr_conditionmax" type="number" min="0" max="20" value="0" /><br/>
                <label class="sheet-label-casedroite" data-i18n="actuel">Actuel</label>
                <label class="sheet-label-casegauche" data-i18n="max-p">Max.</label>
            </div>
            <div class="sheet-panneau">
                <span class="thead" data-i18n="nivaeu">Niveau</span>
                <input name="attr_Niveau-monstre" min="1" max="10" value="1" type="number"/>
            </div>
        </div>
        <div class="sheet-col">
            <div class="sheet-monstre-attribut">
                <div></div>
                <label class="sheet-Panneau-label" data-i18n="attributs">Attributs</label>
                <div class="sheet-haut">
                    <label data-i18n="vigueur">Vigueur</label>
                    <input name="attr_VIGM" type="number" step="2" min="4" max="12" value="4" />
                    <button class="sheet-btn" type="roll" value="&{template:base} {{Test=Test de Vigueur}} {{Perso=@{character_name}}} {{die1=[[1d@{VIGM}]]}} {{die2=[[?{2e Attribut ?|VIG, 1d@{VIGM}|AGI, 1d@{AGIM} | INT, 1d@{INTM} | ESP, 1d@{ESPM}}]]}} {{Mod=[[0]]}}"></button>
                </div>
                <div class="sheet-droite">
                    <label data-i18n="agilite">Agilite</label><!-- "Agilité"" brise le code -->
                    <input name="attr_AGIM" type="number" step="2" min="4" max="12" value="4" /> 
                    <button class="sheet-btn" type="roll" value="&{template:base} {{Test=Test d'Agilité}} {{Perso=@{character_name}}} {{die1=[[1d@{AGIM}]]}} {{die2=[[?{2e Attribut ?|VIG, 1d@{VIGM}|AGI, 1d@{AGIM} | INT, 1d@{INTM} | ESP, 1d@{ESPM}}]]}} {{Mod=[[0]]}}"></button>
                </div>
                <div class="sheet-bas">
                    <label data-i18n="intelligence">Intelligence</label>
                    <input name="attr_INTM" type="number" step="2" min="4" max="12" value="4" /> 
                    <button class="sheet-btn" type="roll" value="&{template:base} {{Test=Test d'Intelligence}} {{Perso=@{character_name}}} {{die1=[[1d@{INTM}]]}} {{die2=[[?{2e Attribut ?|VIG, 1d@{VIGM}|AGI, 1d@{AGIM} | INT, 1d@{INTM} | ESP, 1d@{ESPM}}]]}} {{Mod=[[0]]}}"></button>
                </div>
                <div class="sheet-gauche">
                    <label data-i18n="esprit">Esprit</label>
                    <input name="attr_ESPM" type="number" step="2" min="4" max="12" value="4" />
                    <button class="sheet-btn" type="roll" value="&{template:base} {{Test=Test d'Esprit}} {{Perso=@{character_name}}} {{die1=[[1d@{ESPM}]]}} {{die2=[[?{2e Attribut ?|VIG, 1d@{VIGM}|AGI, 1d@{AGIM} | INT, 1d@{INTM} | ESP, 1d@{ESPM}}]]}} {{Mod=[[0]]}}"></button>
                </div>
            </div>
        </div>
    </div> 
    <br>
    <div class="sheet-2colrow">
        <div class="sheet-col">
            <div class="thead" data-i18n="autresattribut">Autres Attributs</div>
            <div class="autres">
                <div>
                    <label data-i18n="nom-c">Nom :</label> <input type="text" name="attr_character_name"/>
                    <label data-i18n="armure-c">Armure :</label><input type="number" name="attr_Armure-monstre" value="0" min="0"/>
                </div>
                <div>
                    <label data-i18n="materiel-c">Matériel :</label><input type="text" name="attr_Materiel"/>
                    <label data-i18n="degats-c">Dégâts :</label>
                    <select name="attr_Dgt-monstre">                
                        <option value="4" data-i18n="d4">d4</option>
                        <option value="6" data-i18n="d6">d6</option>
                        <option value="8" data-i18n="d8">d8</option>
                        <option value="10" data-i18n="d10">d10</option>
                        <option value="12" data-i18n="d12">d12</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="sheet-col">
            <div class="thead" data-i18n="capacitiespeciales">Capacités spéciales</div>
            <textarea rows="3" name="attr_capmonstre"></textarea></div>
        </div>
    </div>
</div>

<div class="sheet-tab-content sheet-tab-gm-sheet">
    <br>
    <div class="sheet-2colrow">
        <div class="sheet-col info">
            <div class="thead" data-i18n="informations">Informations</div>
            <div>
                <label data-i18n="meneur-c">Meneur :</label><input type="text" name="attr_Meneur"/>
            </div>
            <div>
                <label data-i18n="nom-c">Nom :</label><input type="text" name="attr_character_name"/>
            </div>
            <div>
                <label data-i18n="couleur-c">Couleur :</label><input type="text" name="attr_Couleur"/>
            </div>
            <div>
                <label data-i18n="avatar-c">Avatar :</label><input type="text" name="attr_Avatar"/>
            </div>
            <div>
                <label data-i18n="inscription-c">Inscription :</label><input type="text" name="attr_Inscription"/>
            </div>
        </div>
        <div class="sheet-col">
            <div class="thead" data-i18n="vocation-c">Vocation</div>
            <textarea name="attr_Vocation"></textarea>
            <div class="thead" data-i18n="demeure-c">Demeure</div>
            <textarea name="attr_Demeure" style="min-height: 65px;"></textarea>
        </div>
    </div>
    <div class="sheet-2colrow">
        <div class="sheet-col val">
            <div class="thead" data-i18n="valeurs">Valeurs</div>
            <div>
                <label data-i18n="vitalite-c">Vitalité :</label>
                <input value="0" min="0" max="10" name="attr_Vit" type="number" />;/;<input value="@{Vit5} + @{Vit10} + 3" name="attr_VitMax" type="number" disabled/>
            </div>
            <div>
                <label data-i18n="sessionsjouees-c">Sessions jouées :</label>
                <input value="0" min="0" name="attr_Session" type="number" />
                <label data-i18n="niveau-c">Niveau :</label>
                <input value="@{NivDrag}" name="attr_Niveau-Dragon" type="number" disabled/>
            </div>
        </div>
        <div class="sheet-col">
            <div class="thead" data-i18n="voyageursproteges">Voyageurs protégés</div>
            <textarea name="attr_Voyageur"></textarea>
        </div>
    </div>
    <div class="sheet-2colrow">
        <div class="sheet-col">
            <div class="thead" data-i18n="apparencecaractere">Apparence - Caractère</div>
            <textarea name="attr_Apparence"></textarea>
        </div>
        <div class="sheet-col">
            <div class="thead" data-i18n="mondesproteges">Mondes protégés</div>
            <textarea name="attr_Monde"></textarea>
        </div>
    </div>
    <div class="thead art-head">
        <span data-i18n="artefacts">Artéfacts</span>
        <span data-i18n="effets">Effets</span>
        <span data-i18n="selec">Sélec.</span>
    </div>
    <div class="art">
        <div>
            <input type="text" name="attr_Artefact1"/>
            <input type="text" name="attr_ArtefactE1"/>
            <input type="checkbox" name="attr_AtefactS1" value="1"/>
        </div>
        <div>
            <input type="text" name="attr_Artefact2"/>
            <input type="text" name="attr_ArtefactE2"/>
            <input type="checkbox" name="attr_AtefactS2" value="1"/>
        </div>
        <div>
            <input type="text" name="attr_Artefact3"/>
            <input type="text" name="attr_ArtefactE3"/>
            <input type="checkbox" name="attr_AtefactS3" value="1"/>
        </div>
    </div>
    <div class="sheet-2colrow sou">
        <input type="checkbox" class="showDiv" name="attr_affDragNiv2" value="1" checked>
        <div class="sheet-col">
            <div class="thead">
                <span data-i18n="souffles">Souffles</span>
                <span data-i18n="effets">Effets</span>
            </div>
            <div class="sou-row">
                <div>
                    <input type="text" name="attr_Souffle1"/>
                    <label data-i18n="utilisation-c">Utilisation :</label><input type="checkbox" name="attr_SouffleU1" value="1"/>
                </div>
                <div>
                    <textarea name="attr_SouffleS1"></textarea>
                </div>
            </div>
            <div class="sou-row">
                <div>
                    <input type="text" name="attr_Souffle2"/>
                    <label data-i18n="utilisation-c">Utilisation :</label><input type="checkbox" name="attr_SouffleU2" value="1"/>
                </div>
                <div>
                    <textarea name="attr_SouffleS2"></textarea>
                </div>
            </div>
            <div class="sou-row">
                <div>
                    <input type="text" name="attr_Souffle3"/>
                    <label data-i18n="utilisation-c">Utilisation :</label><input type="checkbox" name="attr_SouffleU3" value="1"/>
                </div>
                <div>
                    <textarea name="attr_SouffleS3"></textarea>
                </div>
            </div>
            <div class="sou-row">
                <div>
                    <input type="text" name="attr_Souffle4"/>
                    <label data-i18n="utilisation-c">Utilisation :</label><input type="checkbox" name="attr_SouffleU4" value="1"/>
                </div>
                <div>
                    <textarea name="attr_SouffleS4"></textarea>
                </div>
            </div>
        </div>
        <div class="sheet-col">
            <div class="thead">
                <span data-i18n="eveils">Éveils</span>
                <span data-i18n="effets">Effets</span>
            </div>
            <div class="sou-row">
                <div>
                    <input type="text" name="attr_Eveil1"/>
                    <label data-i18n="utilisation-c">Utilisation :</label><input type="checkbox" name="attr_EveilU1" value="1"/>
                </div>
                <div>
                    <textarea name="attr_EveilS1"></textarea>
                </div>
            </div>
            <div class="sou-row">
                <div>
                    <input type="text" name="attr_Eveil2"/>
                    <label data-i18n="utilisation-c">Utilisation :</label><input type="checkbox" name="attr_EveilU2" value="1"/>
                </div>
                <div>
                    <textarea name="attr_EveilS2"></textarea>
                </div>
            </div>
            <div class="sou-row">
                <div>
                    <input type="text" name="attr_Eveil3"/>
                    <label data-i18n="utilisation-c">Utilisation :</label><input type="checkbox" name="attr_EveilU3" value="1"/>
                </div>
                <div>
                    <textarea name="attr_EveilS3"></textarea>
                </div>
            </div>
            <div class="sou-row">
                <div>
                    <input type="text" name="attr_Eveil4"/><br> 
                    <label data-i18n="utilisation-c">Utilisation :</label><input type="checkbox" name="attr_EveilU4" value="1"/>
                </div>
                <div>
                    <textarea name="attr_EveilS4"></textarea>
                </div>
            </div>
        </div>
    </div>
    <div class="thead" data-i18n="historique">Historique</div>
    <div class="hist">
        <div class="thead">
            <span data-i18n="scenarios">Scénarios</span>
            <span data-i18n="dates">Dates</span>
            <span data-i18n="voyegeurs">Voyageurs</span>
        </div>
        <fieldset class="repeating_historique">
            <div>
                <input type="text" name="attr_Scenario"/>
                <input type="text" name="attr_Date"/>
                <input type="text" name="attr_Voyageur"/>
            </div>
        </fieldset>
    </div>
</div>

<div class="sheet-tab-content sheet-tab-character-sheet">
    <div class="sheet-4colrow">
        <div class="sheet-col">
            <div class="sheet-panneau">
                <span class="thead" data-i18n="ptsdevie">Pts de Vie</span>
                <input name="attr_PV" type="number" min="0" value="0" />
                <div class="sheet-tooltipsdown">
                    <input name="attr_PVmax" type="number" value="(@{VIG} * 2) + @{ModPV} + @{PVNIV2} + @{PVNIV3} + @{PVNIV4} + @{PVNIV5} + @{PVNIV6} + @{PVNIV7} + @{PVNIV8} + @{PVNIV9} + @{PVNIV10} + @{TypePVMod}" disabled />
                    <div><span data-i18n="modpointsdeviemax">Mod. Points de vie Max :</span><input type="number" name="attr_ModPV" value="0"/></div>
                </div>
                <br />
                <label class="sheet-label-casedroite" data-i18n="actuel">Actuel</label>
                <label class="sheet-label-casegauche" data-i18n="max-p">Max.</label>
            </div>
            <div class="sheet-panneau">
                <span class="thead" data-i18n="maldresse">Maladresse</span>
                <input type="number" name="attr_Maladresse" value="0" />
            </div>
        </div>
        <div class="sheet-col">
            <div class="sheet-panneau">
                <span class="thead" data-i18n="ptsdenergie">Pts d'Énergie</span>
                <input name="attr_PE" type="number" min="0" value="0" />
                <div class="sheet-tooltipsdownMid">
                    <input name="attr_PEmax" type="number" value="(@{ESP} * 2) + @{ModPE}  + @{PENIV2} + @{PENIV3} + @{PENIV4} + @{PENIV5} + @{PENIV6} + @{PENIV7} + @{PENIV8} + @{PENIV9} + @{PENIV10} + @{TypePEMod}" disabled /><br />
                    <div><span data-i18n="modpointsenergiemax">Mod. Points d'Énergie Max :</span><input type="number" name="attr_ModPE" value="0"/></div>
                </div>
                <label class="sheet-label-casedroite" data-i18n="actuel">Actuel</label>
                <label class="sheet-label-casegauche" data-i18n="max-p">Max.</label>
            </div>
            <div class="sheet-panneau encom">
                <span class="thead" title="VIG + 3" data-i18n="encombrement">Encombrement</span>
                <input name="attr_EncombAttirail2" value="@{armeEncTotal} + @{armureEncTotal}" type="number" disabled/>
                <div class="sheet-tooltipsdownMid">
                    <input name="attr_encumbrancemax" value="@{EncombMax}" type="number" disabled/>
                    <div>
                        <span data-i18n="modencombrement">Mod. Encombrement :</span>
                        <input type="number" name="attr_EncomMod" value="0"/>
                    </div>
                </div>
                <input name="attr_encumbrance2" value="@{Encomb}" type="number" disabled/>
                <div class="sheet-label-middle">
                    <span data-i18n="attguerre">Att.Guerre</span>
                    <span data-i18n="limite">Limite</span>
                    <span data-i18n="equipement">Équipement</span>
                </div>
            </div>
        </div>
        <div class="sheet-col">
            <div class="sheet-panneau">
                <span class="thead" data-i18n="condition">Condition</span>
                <input name="attr_condition" type="number" min="0" max="20" value="0" />
                <select name="attr_bonus">
                    <option value="0">-</option>
                    <option value="VIG" data-i18n="vig">VIG</option>
                    <option value="AGI" data-i18n="agi">AGI</option>
                    <option value="INT" data-i18n="int">INT</option>
                    <option value="ESP" data-i18n="esp">ESP</option>
                </select>
                <div>
                    <label class="sheet-label-casedroite" data-i18n="actuel">Actuel</label>
                    <label class="sheet-label-casegauche" title="Si votre Condition est supérieure ou égale à 10, gagnez un bonus dans l'Attribut sélectionné" data-i18n="bonus">Bonus</label>
                </div>
            </div>
            <div class="sheet-panneau">
                <span class="thead" title="Niveau 2 = 100xp
                    Niveau 3 = 600xp
                    Niveau 4 = 1 200xp
                    Niveau 5 = 2 000xp
                    Niveau 6 = 3 000xp
                    Niveau 7 = 4 200xp
                    Niveau 8 = 5 800xp
                    Niveau 9 = 7 500xp
                    Niveau 10 = 10 000xp" data-i18n="nivaeu">Niveau
                </span>
                <input name="attr_XPtotal" value="0" type="number"/>
                <input type="number" name="attr_NiveauT" value="@{Niveau}" disabled/>
                <br />
                <label class="sheet-label-casedroite" data-i18n="total">Total</label>
                <label class="sheet-label-casegauche" data-i18n="nivaeu">Niveau</label>
            </div>
        </div>
        <div class="sheet-col">
            <div class="sheet-pj-attribut">
                <label class="sheet-Panneau-label" data-i18n="attributs">Attributs</label>
                <div class="sheet-haut">
                    <label data-i18n="vigueur">Vigueur</label>
                    <input name="attr_VIG2" type="number" value="@{VIGT}" disabled />
                </div>
                <div class="sheet-droite">
                    <label data-i18n="agilite">Agilite</label><!-- "é"" brise le code -->
                    <input name="attr_AGI2" type="number" value="@{AGIT}" disabled /> 
                </div>
                <div class="sheet-bas">
                    <label data-i18n="intelligence">Intelligence</label>
                    <input name="attr_INT2" type="number" value="@{INTT}" disabled /> 
                </div>
                <div class="sheet-gauche">
                    <label data-i18n="esprit">Esprit</label>
                    <input name="attr_ESP2" type="number" value="@{ESPT}" disabled />
                </div>
            </div>
        </div>
    </div>
    <br>
    <div class="sheet-2colrow">
        <div class="sheet-col etats">
            <div class="thead" data-i18n="etats">États</div>
            <div><!-- "é"" brise le code -->
                <label title="Réduit vos dés d'AGI" data-i18n="blesse-c">Blessé :</label><input type="number" name="attr_Blesse" value="0" min="0"/>
                <label title="Réduit vos dés de VIG" data-i18n="empoisone-c">Empoisone :</label><input type="number" name="attr_Poison" value="0" min="0"/>
                <label title="Réduit vos dés d'AGI et de VIG" data-i18n="malade-c">Malade :</label><input type="number" name="attr_Malade" value="0" min="0"/>
            </div>
            <div>
                <label title="Réduit vos dés d'ESP" data-i18n="las-c">Las :</label><input type="number" name="attr_Las" value="0" min="0"/>
                <label title="Réduit vos dés d'INT" data-i18n="sureite-c">Surexite :</label><input type="number" name="attr_Surex" value="0" min="0"/>
                <label title="Réduit vos dés d'ESP et d'INT" data-i18n="choque-c">Choque :</label><input type="number" name="attr_Choc" value="0" min="0"/>
            </div>
        </div>
        <div class="sheet-col saison">
            <div class="thead" data-i18n="modificateursactuels">Modificateurs actuels</div>
            <div>
                <label data-i18n="saison-c">Saison :</label>
                <select name='attr_currentSeason'>
                    <option value="0">-</option>
                    <option value="Spring" data-i18n="pringtemps">Pringtemps</option>
                    <option value="Summer" data-i18n="ete">Éte</option>
                    <option value="Autumn" data-i18n="automne">Automne</option>
                    <option value="Winter" data-i18n="hiver">Hiver</option>
                </select>
                <label data-i18n="terrain-c">Terrain :</label>
                <select name="attr_terrain">
                    <option value="0">-</option>
                    <option value="@{ModPlaine}" data-i18n="plaine">Plaine</option>
                    <option value="@{ModLande}" data-i18n="lande">Lande</option>
                    <option value="@{ModBois}" data-i18n="bois">Bois</option>
                    <option value="@{ModColline}" data-i18n="collines">Collines</option>
                    <option value="@{ModRocaille}" data-i18n="rocaille">Rocaille</option>
                    <option value="@{ModForet}" data-i18n="foret">Forêt</option>
                    <option value="@{ModMarais}" data-i18n="marais">Marais</option>
                    <option value="@{ModMontagne}" data-i18n="montage">Montagne</option>
                    <option value="@{ModDesert}" data-i18n="desert">Désert</option>
                    <option value="@{ModJungle}" data-i18n="jungle">Jungle</option>
                    <option value="@{ModHM}" data-i18n="hmontange">H.Montagne</option>
                </select>
            </div>
            <div>
                <label>Climat :</label>
                <select name="attr_weather">
                    <option value="0">-</option>
                    <option value="@{ModPluie}">Pluie</option>
                    <option value="@{ModVF}">Vent Fort</option>
                    <option value="@{ModBrume}">Brume</option>
                    <option value="@{ModChaleur}">Chaleur</option>
                    <option value="@{ModFroid}">Froid</option>
                    <option value="@{ModOrage}">Orage</option>
                    <option value="@{ModNeige}">Neige</option>
                    <option value="@{ModBrouillard}">Brouillard</option>
                    <option value="@{ModTenebres}">Ténèbres</option>
                    <option value="@{ModTempete}">Tempête</option>
                    <option value="@{ModBlizzard}">Blizzard</option>
                </select>
            </div>
        </div>
    </div>
    <br>
    <div class="character-tabs">
        <input type="radio" name="attr_sheet" class="sheet-tab-new" value="perso" checked="checked" /><span class="sheet-tab-new">;Perso.</span>
        <input type="radio" name="attr_sheet" class="sheet-tab-new" value="skills"/><span class="sheet-tab-new">Test</span>
        <input type="radio" name="attr_sheet" class="sheet-tab-new" value="arms"/><span class="sheet-tab-new">Armes et Armure</span>
        <input type="radio" name="attr_sheet" class="sheet-tab-new" value="equipement"/><span class="sheet-tab-new">Équipement</span>
        <input type="radio" name="attr_sheet" class="sheet-tab-new" value="animaux"/><span class="sheet-tab-new">Animaux</span>
        <input type="radio" name="attr_sheet" class="sheet-tab-new" value="xp"/><span class="sheet-tab-new">Progression</span>
    </div>
    <input type="hidden" name="attr_sheet" class="sheet-character-tab" value="perso"><!-- Above Radio Buttons toggle this input -->
    <div class="tab-perso">
        <h3 class="sheet-section-header" data-i18n="personnage">Personnage</h3>
        <div class="sheet-2colrow">
            <div class="sheet-col">
                <div class="perso-info">
                    <div class="thead" data-i18n="informations">Informations</div>
                    <div>
                        <label data-i18n="nom-c">Nom :</label>
                        <input type="text" name="attr_character_name"/>
                    </div>
                    <div>
                        <label data-i18n="joueur-c">Joueur :</label>
                        <input type="text" name="attr_playername"/>
                    </div>
                    <div>
                        <label data-i18n="race-c">Race :</label>
                        <select name="attr_race">
                            <option value="1" data-i18n="humain">Humain</option>
                            <option value="2" data-i18n="gobelin">Gobelin Koneko</option>
                         </select>
                    </div>
                    <div>
                        <label data-i18n="objetfetiche">Objet fétiche :</label>
                        <input type="text" name="attr_objetfetiche"/>
                    </div>
                    <div>
                        <label data-i18n="role-c">Rôle :</label>
                        <select name="attr_role">
                            <option value="">-</option>
                            <option value="Chroniqueur" data-i18n="chroniqueur">Chroniqueur</option>
                            <option value="Chef" data-i18n="chef">Chef</option>
                            <option value="Cartographe" data-i18n="cartographe">Cartographe</option>
                            <option value="Intendant" data-i18n="intendant">Intendant</option>
                        </select>
                    </div>
                    <div>
                        <label data-i18n="classe-c">Classe :</label>
                        <select name="attr_classe1">
                            <option value="">-</option>
                            <option value="Artisan" data-i18n="artisan">Artisan</option>
                            <option value="Fermier" data-i18n="fermier">Fermier</option>
                            <option value="Guérisseur" data-i18n="guerisseur">Guérisseur</option>
                            <option value="Chasseur" data-i18n="chasseur">Chasseur</option>
                            <option value="Marchand" data-i18n="marchand">Marchand</option>
                            <option value="Ménestrel" data-i18n="menestrel">Ménestrel</option>
                            <option value="Navigateur" data-i18n="navigateur">Navigateur</option>
                            <option value="Noble" data-i18n="noble">Noble</option>
                        </select>
                    </div>
                    <div>
                        <label data-i18n="type-c">Type :</label>
                        <select name="attr_type1">
                            <option value="">-</option>
                            <option value="Attaque" data-i18n="attaque">Attaque</option>
                            <option value="Technique" data-i18n="technique">Technique</option>
                            <option value="Magie" data-i18n="magie">Magie</option>
                        </select>
                    </div>
                    <div>
                        <label data-i18n="saisonm-c">Saison de la Magie :</label>
                        <select name="attr_saison1">
                            <option value="">-</option>
                            <option value="Pringtemps" data-i18n="pringtemps">Pringtemps</option>
                            <option value="Été" data-i18n="ete">Été</option>
                            <option value="Automne" data-i18n="automne" >Automne</option>
                            <option value="Hiver" data-i18n="hiver" >Hiver</option>
                        </select>
                    </div>
                </div>
                <div class="desc">
                    <div class="thead" data-i18n="description">Description</div>
                    <div>
                         <label data-i18n="sexe-c" data-i18n="">Sexe :</label><input class="short" type="text" name="attr_sexe">
                         <label data-i18n="age-c" data-i18n="">Âge :</label><input class="short"  type="text" name="attr_age"/>
                    </div>
                    <div>
                        <label data-i18n="couelerrep">Couleur représentative et autres signes particuliers</label>
                        <textarea rows="3" name="attr_couleuretsigne"></textarea>
                    </div>
                    <div>
                        <label data-i18n="villagenatal">Village natal et raisons du départ</label>
                        <textarea rows="3" name="attr_village"></textarea>
                    </div>
                    <div>
                        <label data-i18n="notes">Notes</label>
                        <textarea rows="3" name="attr_note"></textarea>
                    </div>
                </div>
            </div>
            <div class="sheet-col">
                <div class="arme-fav">
                    <div class="thead" data-i18n="armefavorite">Arme favorite</div>
                    <input type="radio" class="radioChoice" name="attr_initialMastery" value="1"/><span data-i18n="epeecourte">Épée courte</span>
                    <input type="radio" class="radioChoice" name="attr_initialMastery" value="2"/><span data-i18n="epeelounge">Épée longue</span>
                    <input type="radio" class="radioChoice" name="attr_initialMastery" value="3"/><span data-i18n="lance">Lance</span>
                    <input type="radio" class="radioChoice" name="attr_initialMastery" value="5"/><span data-i18n="arc">Arc</span>
                    <input type="radio" class="radioChoice" name="attr_initialMastery" value="4"/><span data-i18n="hache">Hache</span>
                    <input type="radio" class="radioChoice" name="attr_initialMastery" value="6"/><span data-i18n="mainsnues">Mains nues</span>
                </div>
                <input type="checkbox" class="showDiv" name="attr_showAttackTypeMastery" value="1">
                <div class="thead" data-i18n="armefavsup">Arme favorite supplémentaire (Type Attaque)</div>
                 <div class="arme-fav">
                    <input type="radio" class="radioChoice" name="attr_attackTypeMastery" value="1"/><span data-i18n="epeecourte">Épée courte</span>
                    <input type="radio" class="radioChoice" name="attr_attackTypeMastery" value="2"/><span data-i18n="epeelounge">Épée longue</span>
                    <input type="radio" class="radioChoice" name="attr_attackTypeMastery" value="3"/><span data-i18n="lance">Lance</span>
                    <input type="radio" class="radioChoice" name="attr_attackTypeMastery" value="5"/><span data-i18n="arc">Arc</span>
                    <input type="radio" class="radioChoice" name="attr_attackTypeMastery" value="4"/><span data-i18n="hache">Hache</span>
                    <input type="radio" class="radioChoice" name="attr_attackTypeMastery" value="6"/><span data-i18n="mainsnues">Mains nues</span>
                    <br />
                    <i data-i18n="vousne">Vous ne pouvez pas choisir une arme favorite que vous avez déjà. </i>
                </div>
                <input type="checkbox" class="showDiv" name="attr_showSecondAttackTypeMastery" value="1">
                <div class="thead" data-i18n="armefavsup2">Arme favorite supplémentaire (2e Type Attaque)</div>
                 <div class="arme-fav">
                    <input type="radio" class="radioChoice" name="attr_attackTypeMastery2" value="1"/><span data-i18n="epeecourte">Épée courte</span>
                    <input type="radio" class="radioChoice" name="attr_attackTypeMastery2" value="2"/><span data-i18n="epeelounge">Épée longue</span>
                    <input type="radio" class="radioChoice" name="attr_attackTypeMastery2" value="3"/><span data-i18n="lance">Lance</span>
                    <input type="radio" class="radioChoice" name="attr_attackTypeMastery2" value="5"/><span data-i18n="arc">Arc</span>
                    <input type="radio" class="radioChoice" name="attr_attackTypeMastery2" value="4"/><span data-i18n="hache">Hache</span>
                    <input type="radio" class="radioChoice" name="attr_attackTypeMastery2" value="6"/><span data-i18n="mainsnues">Mains nues</span>
                    <br />
                    <i data-i18n="vousne">Vous ne pouvez pas choisir une arme favorite que vous avez déjà. </i>
                </div>
                <input type="checkbox" class="showDiv" name="attr_showWeaponGrace" value="1">
                <div class="thead" data-i18n="escrime">Escrime</div>
                <div class="arme-fav">
                    <input type="radio" class="radioChoice" name="attr_weaponGrace" value="2"/><span data-i18n="epeelounge">Épée longue</span>
                    <input type="radio" class="radioChoice" name="attr_weaponGrace" value="3"/><span data-i18n="lance">Lance</span>
                    <input type="radio" class="radioChoice" name="attr_weaponGrace" value="5"/><span data-i18n="arc">Arc</span>
                    <br />
                    <i data-i18n="sivouschois">Si vous choisissez une seconde fois une même arme favorite, vous gagnez un bonus de +1 pour toucher avec celle-ci.</i>
                </div>
                <input type="checkbox" class="showDiv" name="attr_showSecondWeaponGrace" value="1">
                <div class="thead" data-i18n="escrime2">Escrime (2e Classe de Noble)</div>
                <div class="arme-fav">
                    <input type="radio" class="radioChoice" name="attr_weaponGrace2" value="2"/><span data-i18n="epeelounge">Épée longue</span>
                    <input type="radio" class="radioChoice" name="attr_weaponGrace2" value="3"/><span data-i18n="lance">Lance</span>
                    <input type="radio" class="radioChoice" name="attr_weaponGrace2" value="5"/><span data-i18n="arc">Arc</span>
                    <br />
                    <i data-i18n="sivouschois">Si vous choisissez une seconde fois une même arme favorite, vous gagnez un bonus de +1 pour toucher avec celle-ci.</i>
                    <br/>
                    <i data-i18n="vousnepouvez">Vous ne pouvez pas choisir une arme d'escrime que vous avez déjà.</i>
                </div>
                <div class="thead" data-i18n="sortsmuscap">Sorts, Musiques et Capacites</div>
                <div class="arme-fav talent">
                     <fieldset class="repeating_talent">
                        <div>
                            <input class="tal-name" type="text" name="attr_nomsort"/>
                            <label data-i18n="type-c">Type :</label> 
                            <select name="attr_sortType">
                                <option value=""></option>
                                <option value="Musique" data-i18n="musique">Musique</option>
                                <option value="Rituelle" data-i18n="rituelle">Rituelle</option>
                                <option value="Saison (Pringtemps)" data-i18n="saisonpringtemps">Saison (Pringtemps)</option>
                                <option value="Saison (Été)" data-i18n="saisonete">Saison (Ete)</option>
                                <option value="Saison (Automne)" data-i18n="saisonautomne">Saison (Automne)</option>
                                <option value="Saison (Hiver)" data-i18n="saisonhiver">Saison (Hiver)</option>
                                <option value="Autre" data-i18n="autre">Autre</option> 
                            </select> 
                        </div>
                        <div>
                            <label data-i18n="portee-c">Portee :</label><input type="text" name="attr_portéesort"/>
                            <label data-i18n="cible-c">Cible :</label><input type="text" name="attr_ciblesort"/>
                        </div>
                        <div>
                            <label data-i18n="coute-c">Coût :</label><input type="text" name="attr_coutsort"/>
                            <label data-i18n="duree-c">Duree :</label><input type="text" name="attr_dureesort"/>
                        </div>
                        <textarea placeholder="Effet" name="attr_effetsort"></textarea>
                    </fieldset>
                </div>
            </div>
        </div>
        <h3 class="sheet-section-header" data-i18n="modifdet">Modificateurs de Terrains et de Climats</h3>
        <div class="thead" data-i18n="terrain">Terrain</div>
        <div class="terrain">
            <div class="thead">
                <span data-i18n="nivaeu-1">Niveau 1 (6)</span>
                <span data-i18n="nivaeu-2">Niveau 2 (8)</span>
                <span data-i18n="nivaeu-3">Niveau 3 (10)</span>
                <span data-i18n="nivaeu-4">Niveau 4 (12)</span>
                <span data-i18n="nivaeu-5">Niveau 5 (14)</span>
            </div>
            <div>
                <label data-i18n="plains-c">Plaines :</label><input type="number" name="attr_grasslandMod" value="0" />
                <label data-i18n="bois-c">Bois :</label><input type="number" name="attr_woodsMod" value="0" />
                <label data-i18n="forets-c">Forêts :</label><input type="number" name="attr_deepForestMod" value="0" />
                <label data-i18n="deserts-c">Déserts :</label><input type="number" name="attr_desertMod" value="0" />
                <label data-i18n="hautesmon-c">Hautes montagnes :</label><input type="number" name="attr_alpineMod" value="0" />
            </div>
            <div>
                <label data-i18n="landes-c">Landes :</label><input type="number" name="attr_wastelandMod" value="0" />
                <label data-i18n="collines-c">Collines :</label><input type="number" name="attr_highlandsMod" value="0" />
                <label data-i18n="marais-c">Marais :</label><input type="number" name="attr_swampMod" value="0" />
                <label data-i18n="jungles-c">Jungles :</label><input type="number" name="attr_jungleMod" value="0" />
            </div>
            <div class="ter-last">
                <label data-i18n="rocailles-c">Rocailles :</label><input type="number" name="attr_rockyTerrainMod" value="0" />
                <label data-i18n="montagnes-c">Montagnes :</label><input type="number" name="attr_mountainMod" value="0" />
            </div>
        </div>
        <div class="thead" data-i18n="climat">Climat</div>
        <div class="climat">
            <div class="thead">
                <span data-i18n="niveau-1-p">Niveau 1 (+1)</span>
                <span data-i18n="niveau-2-p">Niveau 2 (+2)</span>
                <span data-i18n="niveau-3-p">Niveau 3 (+3)</span>
            </div>
            <div>
                <label data-i18n="brume-c">Brume :</label><input type="number" name="attr_fogMod" value="0" />
                <label data-i18n="chaleur-c">Chaleur :</label><input type="number" name="attr_hotMod" value="0" />
                <label data-i18n="brouillard-c">Brouillard :</label><input type="number" name="attr_deepFogMod" value="0" />
                <label data-i18n="neige-c">Neige :</label><input type="number" name="attr_snowMod" value="0" />
                <label data-i18n="blizzard-c">Blizzard :</label><input type="number" name="attr_blizzardMod" value="0" />
            </div>
            <div>
                <label data-i18n="froid-c">Froid :</label><input type="number" name="attr_coldMod" value="0" />
                <label data-i18n="pluie-c">Pluie :</label><input type="number" name="attr_rainMod" value="0" />
                <label data-i18n="orage-c">Orage :</label><input type="number" name="attr_hardRainMod" value="0" />
                <label data-i18n="tenebres-c">Ténèbres :</label><input type="number" name="attr_darkMod" value="0" />
                <label data-i18n="tempete-c">Tempête :</label><input type="number" name="attr_hurricaneMod" value="0" />
            </div>
            <div>
                <label data-i18n="ventfort-c">Vent fort :</label><input type="number" name="attr_strongWindMod" value="0" />
            </div>
        </div>
    </div>
    <div class="tab-skills">
        <h3 class="sheet-section-header" data-i18n="testscomun">Tests communs</h3>
        <input value="?{Concentration|Non, 0|Oui, 1+@{ConcentrationMod}} [Concentration] + @{terrain} [Terrain] + @{weather} [Climat] + @{MalusEnc} [Encombrement]" name="attr_ModPaysage" type="hidden" />
        <input value="@{terrain} [Terrain] + @{weather} [Climat] + @{MalusEnc} [Encombrement]" name="attr_ModPaysageSC" type="hidden" />
        <input value="?{Concentration|Non, 0|Oui, 1+@{ConcentrationMod}} [Concentration] + @{MalusEnc} [Encombrement]" name="attr_ModAll" type="hidden" />
        <div class="sheet-2colrow">
            <div class="sheet-col">
                <!--- Start Condition -->
                <div class="skill-row">
                    <div class="skill-head"><b>Condition</b></div>
                    <div class="sheet-tips">
                        <div class="sheet-help-def sheet-help">
                            <div class="sheet-icon">
                                <span class="sheet-icon-question">?</span>
                            </div>
                            <div class="sheet-help-content">
                                <p>
                                    Chaque matin, vous devez effectuer un test de Condition.
                                </p>
                                <p><b>Effet : </b> Le résultat du test détermine votre valeur de Condition pour la journée.</p>
                                <p><b>Nuit blanche : </b>Si vous ne dormez pas durant la nuit, réduisez de moitié le résultat de votre test de Condition, arrondit à l'inférieur. </p>
                                <p><b>Armure : </b>Si vous dormez en armure, ajoutez son Malus à votre test. </p>
                                <p><b>Difficulté : </b> Aucune.</p>
                            </div>
                        </div>
                    </div>
                    <div class="skill-stat">
                        <!---:+:+: Vindikaell, remplacer au besoin data-i18n="" vig/esp/int/agi :+:+:+:--->
                        (<span data-i18n="vig">VIG</span><span> + </span><span data-i18n="esp">ESP</span>)
                    </div>
                    <div class="skill-inputs">
                        <span data-i18n="mod-c">Mod :</span>
                        <input value="0" name="attr_Modbase-Condition" type="number" />
                        <input value="@{Modbase-Condition} [Mod. divers] + @{classeConditionMod} [Mod. Classe] + @{BonusSaisonKoneko} [Mod. Race]" name="attr_Mod-Condition" type="hidden" />
                        <button class="sheet-btn" type="roll" value="&{template:base} {{Test=Test de Condition}} {{Perso=@{character_name}}} {{Carac=VIG + ESP}} {{die1=[[1d@{VIGT}]]}} {{die2=[[1d@{ESPT}]]}} {{Mod=[[@{Mod-Condition}]]}} {{Condition=1}}"></button>
                    </div>
                </div>
                <!--End of Condition -->
                <!---:+:+:+: Vindikaell, Ajouter d'autres tests ici.  :+:+:+:--->
            </div>
            <div class="sheet-col">
                <!--- Start Deplacement -->
                <div class="skill-row">
                    <div class="skill-head"><b>Deplacement</b></div>
                    <div class="sheet-tips">
                        <div class="sheet-help-def sheet-help">
                            <div class="sheet-icon">
                                <span class="sheet-icon-question">?</span>
                            </div>
                            <div class="sheet-help-content">
                                <p>
                                    Chaque jour de voyage, vous devez effectuer un test de Déplacement.
                                </p>
                                <p><b>Effet : </b> Le résultat du test détermine si vous avancez sans difficulté.</p>
                                <p><b>Difficulté : </b> Paysage. 
                            </div>
                        </div>
                    </div>
                    <div class="skill-stat">
                        <!---:+:+: Vindikaell, remplacer au besoin data-i18n="" vig/esp/int/agi :+:+:+:--->
                        (<span data-i18n="vig">VIG</span><span> + </span><span data-i18n="agi">AGI</span>)
                    </div>
                    <div class="skill-inputs">
                        <span data-i18n="mod-c">Mod :</span>
                        <input value="0" name="attr_Modbase-Dep" type="number" />
                        <input value="@{Modbase-Dep} [Mod. divers] + @{ModPaysage} + @{classeTravelMod} [Mod. Classe]" name="attr_Mod-Dep" type="hidden" />
                        <button class="sheet-btn" type="roll" value="&{template:base} {{Test=Test de Déplacement}} {{Perso=@{character_name}}} {{Carac=VIG + AGI}} {{die1=[[1d@{VIGT}]]}} {{die2=[[1d@{AGIT}]]}} {{Mod=[[@{Mod-Dep} + @{Malustotal}]]}} {{Deplacement=1}}"></button>
                    </div>
                </div>
                <!--End of Deplacement -->
                <!---:+:+:+: Vindikaell, Ajouter d'autres tests ici.  :+:+:+:--->
            </div>
        </div>
    </div>
    <div class="tab-armes">
    </div>
    <div class="tab-equipement">
    </div>
    <div class="tab-animaux">
    </div>
    <div class="tab-xp">
    </div>
<div>

<rolltemplate class="sheet-rolltemplate-base">
    <div class="container">
        {{#Test}}
            <div><h1>{{Test}}</h1></div>
            <div><span class="subheader">{{Carac}}</span></div>
            <div><span class="subheader">{{Perso}}</span></div>
            <div class="arrow-container"><div class="arrow-right"></div></div>
            <div class="rowcolor"><span class="tcat"><b>Résultat : </b></span>{{die1}} + {{die2}} + {{Mod}}</div>
            
            {{#Melodie}}
                <div class="rowcolor"><span class="tcat"><b>Réussite : </b></span>Tous vos compagnons bénéficient d'un bonus de +1 au test suivant l'utilisation de la mélodie.<br><b>Spécial : </b>Vous perdez 1 PV. </div>
            {{/Melodie}}
            {{#Commerce}}
                <div class="rowcolor"><span class="tcat"><b>Réussite : </b></span>Vous réduisez (ou augmentez) le prix de vente ou d'achat de : 
                <br><b>6-7 :</b>10%
                <br><b>8-9 :</b>20%
                <br><b>10-13 :</b>40%
                <br><b>14-17 :</b>60%
                <br><b>18+ :</b>80%
                </div>
            {{/Commerce}}
            {{#Creation}}
                <div class="rowcolor"><span class="tcat"><b>Réussite : </b></span>Vous créez un objet du type choisi lors de l'obtention de ce talent.<br><b>Échec : </b>Utiliser ce talent à nouveau prend du temps, mais n'engendre pas de coût supplémentaire. <br><b>Durée : </b> Encombrement de l'objet en jours. <br><b>Coût : </b> Moitié de son prix.</div>
            {{/Creation}}
            {{#Repa}}
                <div class="rowcolor"><span class="tcat"><b>Réussite : </b></span>La résistance de l'équipement réparé revient à son maximum.<br><b>Durée : </b> Encombrement de l'objet en heures. <br><b>Coût : </b> Chaque tentative de réparation coûte 10 % du prix de l'objet.</div>
            {{/Repa}}
            {{#Transf}}
                <div class="rowcolor"><span class="tcat"><b>Réussite : </b></span>Vous transformez la dépouille d'un monstre en objets dépendant de son profil.</div>
            {{/Transf}}
            {{#Chasse}}
                <div class="rowcolor"><span class="tcat"><b>Réussite : </b></span>Vous pouvez nourrir autant de personnes que le résultat du test, mais vous ne pouvez aider à monter le campement.</div>
            {{/Chasse}}
            {{#Four}}
                <div class="rowcolor"><span class="tcat"><b>Réussite : </b></span>Vous trouvez autant d'unité de nouriture et d'eau que le Résultat de votre test. Cependant, la vitesse de déplacement du groupe pour cette journée de voyage est réduite de moitié. </div>
            {{/Four}}
            {{#Condition}}
                <div class="rowcolor"><span class="tcat"><b>Réussite : </b></span>Votre Condition pour la journée est égale au résultat du test.</div>
            {{/Condition}}
            {{#Deplacement}}
                <div class="rowcolor"><span class="tcat"><b>Réussite : </b></span>Vous voyagez sans difficulté.<br><b>Échec :</b> Réduisez vos PV de moitié, arrondit à l'inférieur.</div>
            {{/Deplacement}}
            {{#Orientation}}
                <div class="rowcolor"><span class="tcat"><b>Réussite : </b></span>Vous vous orientez sans difficulté.<br><b>Échec :</b> Réduisez par deux votre déplacement de la journée. Si vous traversez la même zone le lendemain, ajoutez +1 à votre test d'Orientation. </div>
            {{/Orientation}}
            {{#Campement}}
                <div class="rowcolor"><span class="tcat"><b>Réussite : </b></span>Vous montez le camp sans difficulté. Tous les voyageurs regagnent la totalité de leur points d'Énergie et doublent leur points de Vie actuels (arrondi au supérieur). <br><b>Échec :</b> Les voyageurs ne regagne que 2 points d'Énergie et de Vie.</div>
            {{/Campement}}
            {{#Soins}}
                <div class="rowcolor"><span class="tcat"><b>Réussite : </b></span>Le compagnon ciblé récupère autant de PV que le résultat du test.<br><b>Spécial : </b>Vous devez dépenser 1 unité d'herbes de soins et 1 unité d'eau.</div>
            {{/Soins}}
            {{#Herbe}}
                <div class="rowcolor"><span class="tcat"><b>Réussite : </b></span>Vous obtenez 1 unité d'herbes de soins.</div>
            {{/Herbe}}
            {{#Traque}}
                <div class="rowcolor"><span class="tcat"><b>Réussite : </b></span>Vous découvrez où se trouve un monstre et bénéficiez d'un bonus de +1 aux dégâts que vous lui infligé.</div>
            {{/Traque}}
            {{#Elixir}}
                <div class="rowcolor"><span class="tcat"><b>Réussite : </b></span>Les symptômes de l'État de la cible disparaissent pendant 1 heure et la Difficulté de ce dernier baisse de {{Niveau}}. <br>Si l'État est réduit à 0 ou moins, il disparaît. <br>Un personnage ne peut bénéficier d'un Élixir Miracle qu'une fois par jour. </div>
            {{/Elixir}}
            {{#Legende}}
                <div class="rowcolor"><span class="tcat"><b>Réussite : </b></span>Vous obtenez des informations encore plus précises sur ce dont vous venez d'entendre parler. </div>
            {{/Legende}}   
            {{#Erud}}
                <div class="rowcolor"><span class="tcat"><b>Réussite : </b></span>Vous obtenez des informations encore plus précises sur ce dont vous venez d'entendre parler. </div>
            {{/Erud}}    
            {{#Etiquette}}
                <div class="rowcolor"><span class="tcat"><b>Réussite : </b></span>Vous impressionnez un autre personnage issu de la haute société. </div>
            {{/Etiquette}}
            {{#Navigation}}
                <div class="rowcolor"><span class="tcat"><b>Réussite : </b></span>Vous manuvrez sans difficulté votre bateau. </div>
            {{/Navigation}}
            {{#Cuisine}}
                <div class="rowcolor"><span class="tcat"><b>Réussite : </b></span>Vous améliorez la qualité des rations dun nombre de compagnon égal à votre Résultat.  </div>
            {{/Cuisine}}
                                                            
                                                     
                    {{#rollWasFumble() die1}}
                        {{#rollWasFumble() die2}}
                            <div class="fumble">MALADRESSE !!!</div>
                            {{#Attaque}}
                                <div class="rowcolor">Votre arme perd 1 point de Durabilité.</div>
                            {{/Attaque}}
                            {{#Melodie}}
                                <div class="rowcolor">Vos compagnons dont la Condition est inférieure ou égale à 6 subissent l'état Surexcité (6).</div>
                            {{/Melodie}}
                            {{#Chasse}}
                                <div class="rowcolor">Vous subissez l'état Blessé (6).</div>
                            {{/Chasse}}
                            {{#Herbe}}
                                <div class="rowcolor">Vous subissez l'état Empoisonné (6).</div>
                            {{/Herbe}}
                            {{#Condition}}
                                <div class="rowcolor">Vous subissez l'état Blessé (4), Empoisonné (4), Las (4) ou Surexité (4).</div>
                            {{/Condition}}
                            {{#Deplacement}}
                                <div class="rowcolor">Réduisez à la place vos PV de trois-quarts, arrondit à l'inférieur.</div>
                            {{/Deplacement}}
                            {{#Campement}}
                                <div class="rowcolor">Les voyageurs ne regagnent aucun point d'Énergie ou de Vie. De plus, ils ajoutent -1 à leur prochain test de Condition.</div>
                            {{/Campement}}
                            {{#Cuisine}}
                                <div class="rowcolor">Tous vos compagnons qui ont mangé vos rations cuisinées et qui obtiennent une Condition de 6 ou moins le lendemain subissent l'état Las (6).</div>
                            {{/Cuisine}}
                        {{/rollWasFumble() die2}}
                    {{/rollWasFumble() die1}}
                        {{#Dgt}}
                            <div class="arrow-container"><div class="arrow-right"></div></div>
                            <div class="rowcolor"><span class="tcat"><b>Dégâts : </b></span>{{Dgt}}</div>
                        {{/Dgt}}
                            {{#rollWasCrit() die1}}
                                {{#rollWasCrit() die2}}
                                    <div class="critical">CRITIQUE !!!</div>
                                        {{#Dgtcrit}}
                                            <div class="rowcolor"><span class="tcat"><b>Dégâts + </b></span>{{Dgtcrit}}</div>
                                        {{/Dgtcrit}}
                                        {{#Melodie}}
                                            <div class="rowcolor">Le bonus de votre Mélodie passe à de +3.</div>
                                        {{/Melodie}}
                                        {{#Chasse}}
                                            <div class="rowcolor">La nourriture obtenue est considérée comme un bon repas (+1 au test de Condition du lendemain).</div>
                                        {{/Chasse}}
                                        {{#Herbe}}
                                            <div class="rowcolor">Vous obtenez 2 unités d'herbes de soins supplémentaire.</div>
                                        {{/Herbe}}
                                        {{#Deplacement}}
                                            <div class="rowcolor">Ajoutez +1 à votre prochain test de Condition.</div>
                                        {{/Deplacement}}
                                        {{#Orientation}}
                                            <div class="rowcolor">Vous vous orientez correctement, quelque soit le Terrain et le Climat.</div>
                                        {{/Orientation}}
                                        {{#Campement}}
                                            <div class="rowcolor">Les voyageurs recouvrent tous leurs points d'Énergie et de Vie. De plus, ils ajoutent +1 à leur prochain test de Condition.</div>
                                        {{/Campement}}
                                        {{#Cuisine}}
                                            <div class="rowcolor">Tous vos compagnons qui ont mangé vos rations cuisinées peuvent relancer leur test de Condition du lendemain.</div>
                                        {{/Cuisine}}
                                {{/rollWasCrit() die2}}
                            {{/rollWasCrit() die1}}
                            {{#rollTotal() die1 6}}
                                {{#rollTotal() die2 6}}
                                    {{#^rollWasCrit() die1}}
                                        {{#^rollWasCrit() die2}}
                                            <div class="critical">CRITIQUE !!!</div>
                                                {{#Dgtcrit}}
                                                    <div class="rowcolor"><span class="tcat"><b>Dégâts + </b></span>{{Dgtcrit}}</div>
                                                {{/Dgtcrit}}
                                                {{#Melodie}}
                                                    <div class="rowcolor">Le bonus de votre Mélodie passe à de +3.</div>
                                                {{/Melodie}}
                                                {{#Chasse}}
                                                    <div class="rowcolor">La nourriture obtenue est considérée comme un bon repas (+1 au test de Condition du lendemain).</div>
                                                {{/Chasse}}
                                                {{#Herbe}}
                                                    <div class="rowcolor">Vous obtenez 2 unités d'herbes de soins supplémentaire.</div>
                                                {{/Herbe}}
                                                {{#Deplacement}}
                                                    <div class="rowcolor">Ajoutez +1 à votre prochain test de Condition.</div>
                                                {{/Deplacement}}
                                                {{#Orientation}}
                                                    <div class="rowcolor">Vous vous orientez correctement, quelque soit le Terrain et le Climat.</div>
                                                {{/Orientation}}
                                                {{#Campement}}
                                                    <div class="rowcolor">Les voyageurs recouvrent tous leurs points d'Énergie et de Vie. De plus, ils ajoutent +1 à leur prochain test de Condition.</div>
                                                {{/Campement}}
                                                {{#Cuisine}}
                                                    <div class="rowcolor">Tous vos compagnons qui ont mangé vos rations cuisinées peuvent relancer leur test de Condition du lendemain.</div>
                                                {{/Cuisine}}
                                        {{/^rollWasCrit() die2}}
                                    {{/^rollWasCrit() die1}}
                                    {{#rollWasCrit() die1}}
                                        {{#^rollWasCrit() die2}}
                                            <div class="critical">CRITIQUE !!!</div>
                                                {{#Dgtcrit}}
                                                    <div class="rowcolor"><span class="tcat"><b>Dégâts + </b></span>{{Dgtcrit}}</div>
                                                {{/Dgtcrit}}
                                                {{#Melodie}}
                                                    <div class="rowcolor">Le bonus de votre Mélodie passe à de +3.</div>
                                                {{/Melodie}}
                                                {{#Chasse}}
                                                    <div class="rowcolor">La nourriture obtenue est considérée comme un bon repas (+1 au test de Condition du lendemain).</div>
                                                {{/Chasse}}
                                                {{#Herbe}}
                                                    <div class="rowcolor">Vous obtenez 2 unités d'herbes de soins supplémentaire.</div>
                                                {{/Herbe}}
                                                {{#Deplacement}}
                                                    <div class="rowcolor">Ajoutez +1 à votre prochain test de Condition.</div>
                                                {{/Deplacement}}
                                                {{#Orientation}}
                                                    <div class="rowcolor">Vous vous orientez correctement, quelque soit le Terrain et le Climat.</div>
                                                {{/Orientation}}
                                                {{#Campement}}
                                                    <div class="rowcolor">Les voyageurs recouvrent tous leurs points d'Énergie et de Vie. De plus, ils ajoutent +1 à leur prochain test de Condition.</div>
                                                {{/Campement}}
                                                {{#Cuisine}}
                                                    <div class="rowcolor">Tous vos compagnons qui ont mangé vos rations cuisinées peuvent relancer leur test de Condition du lendemain.</div>
                                                {{/Cuisine}}
                                        {{/^rollWasCrit() die2}}
                                    {{/rollWasCrit() die1}}
                                    {{#^rollWasCrit() die1}}
                                        {{#rollWasCrit() die2}}
                                            <div class="critical">CRITIQUE !!!</div>
                                                {{#Dgtcrit}}
                                                    <div class="rowcolor"><span class="tcat"><b>Dégâts + </b></span>{{Dgtcrit}}</div>
                                                {{/Dgtcrit}}
                                                {{#Melodie}}
                                                    <div class="rowcolor">Le bonus de votre Mélodie passe à de +3.</div>
                                                {{/Melodie}}
                                                {{#Chasse}}
                                                    <div class="rowcolor">La nourriture obtenue est considérée comme un bon repas (+1 au test de Condition du lendemain).</div>
                                                {{/Chasse}}
                                                {{#Herbe}}
                                                    <div class="rowcolor">Vous obtenez 2 unités d'herbes de soins supplémentaire.</div>
                                                {{/Herbe}}
                                                {{#Deplacement}}
                                                    <div class="rowcolor">Ajoutez +1 à votre prochain test de Condition.</div>
                                                {{/Deplacement}}
                                                {{#Orientation}}
                                                    <div class="rowcolor">Vous vous orientez correctement, quelque soit le Terrain et le Climat.</div>
                                                {{/Orientation}}
                                                {{#Campement}}
                                                    <div class="rowcolor">Les voyageurs recouvrent tous leurs points d'Énergie et de Vie. De plus, ils ajoutent +1 à leur prochain test de Condition.</div>
                                                {{/Campement}}
                                                {{#Cuisine}}
                                                    <div class="rowcolor">Tous vos compagnons qui ont mangé vos rations cuisinées peuvent relancer leur test de Condition du lendemain.</div>
                                                {{/Cuisine}}
                                        {{/rollWasCrit() die2}}
                                    {{/^rollWasCrit() die1}}
                                {{/rollTotal() die2 6}}
                            {{/rollTotal() die1 6}}
                    
            </div>
        {{/Test}}
        {{#Init}}
            <div><h1>{{Init}}</h1></div>
            <div><span class="subheader">{{Carac}}</span></div>
            <div><span class="subheader">{{Perso}}</span></div>
            <div class="arrow-container"><div class="arrow-right"></div></div>
            <div class="rowcolor"><span class="tcat"><b>Résultat : </b></span>{{die1}}</div>
        {{/Init}}
        
    </div>
</rolltemplate>


<script type="text/worker">

var TAS = TAS || (function(){
    'use strict';
    var version = '0.2.3',
        lastUpdate = 1457098056,
        loggingSettings = {
            debug: {
                key:     'debug',
                title:   'DEBUG',
                color: {
                    bgLabel: '#7732A2',
                    label:   '#F2EF40',
                    bgText:  '#FFFEB7',
                    text:    '#7732A2'
                }
            },
            error: {
                key:     'error',
                title:   'Error',
                color: {
                    bgLabel: '#C11713',
                    label:   'white',
                    bgText:  '#C11713',
                    text:    'white'
                }
            },
            warn: {
                key:     'warn',
                title:   'Warning',
                color: {
                    bgLabel: '#F29140',
                    label:   'white',
                    bgText:  '#FFD8B7',
                    text:    'black'
                }
            },
            info: {
                key:     'info',
                title:   'Info',
                color: {
                    bgLabel: '#413FA9',
                    label:   'white',
                    bgText:  '#B3B2EB',
                    text:    'black'
                }
            },
            notice: {
                key:     'notice',
                title:   'Notice',
                color: {
                    bgLabel: '#33C133',
                    label:   'white',
                    bgText:  '#ADF1AD',
                    text:    'black'
                }
            },
            log: {
                key:     'log',
                title:   'Log',
                color: {
                    bgLabel: '#f2f240',
                    label:   'black',
                    bgText:  '#ffff90',
                    text:    'black'
                }
            },
            callstack: {
                key:     'TAS',
                title:   'function',
                color: {
                    bgLabel: '#413FA9',
                    label:   'white',
                    bgText:  '#B3B2EB',
                    text:    'black'
                }
            },
            callstack_async: {
                key:     'TAS',
                title:   'ASYNC CALL',
                color: {
                    bgLabel: '#413FA9',
                    label:   'white',
                    bgText:  '#413FA9',
                    text:    'white'
                }
            },
            TAS: {
                key:     'TAS',
                title:   'TAS',
                color: {
                    bgLabel: 'grey',
                    label:   'black;background:linear-gradient(#304352,#d7d2cc,#d7d2cc,#d7d2cc,#304352)',
                    bgText:  'grey',
                    text:    'black;background:linear-gradient(#304352,#d7d2cc,#d7d2cc,#d7d2cc,#304352)'
                }
            }
        },
        config = {
            debugMode: false,
            logging: {
                log: true,
                notice: true,
                info: true,
                warn: true,
                error: true,
                debug: false
            }
        },
        callstackRegistry = [],
		queuedUpdates = {}, //< Used for delaying saves till the last momment.
    complexType = function(o){
        switch(typeof o){
            case 'string':
                return 'string';
            case 'boolean':
                return 'boolean';
            case 'number':
                return (_.isNaN(o) ? 'NaN' : (o.toString().match(/\./) ? 'decimal' : 'integer'));
            case 'function':
                return 'function: '+(o.name ? o.name+'()' : '(anonymous)');
            case 'object':
                return (_.isArray(o) ? 'array' : (_.isArguments(o) ? 'arguments' : ( _.isNull(o) ? 'null' : 'object')));
            default:
                return typeof o;
        }
    },
	dataLogger = function(primaryLogger,secondaryLogger,data){
        _.each(data,function(m){
            var type = complexType(m);
            switch(type){
                case 'string':
                    primaryLogger(m);
                    break;
                case 'undefined':
                case 'null':
                case 'NaN':
                    primaryLogger('['+type+']');
                    break;
                case 'number':
                case 'not a number':
                case 'integer':
                case 'decimal':
                case 'boolean':
                    primaryLogger('['+type+']: '+m);
                    break;
                default:
                    primaryLogger('['+type+']:=========================================');
                    secondaryLogger(m);
                    primaryLogger('=========================================================');
                    break;
            }
        });
	},
    colorLog = function(options){
        var coloredLoggerFunction,
            key = options.key,
            label = options.title || 'TAS',
            lBGColor = (options.color && options.color.bgLabel) || 'blue',
            lTxtColor = (options.color && options.color.label) || 'white',
            mBGColor = (options.color && options.color.bgText) || 'blue',
            mTxtColor = (options.color && options.color.text) || 'white';
        coloredLoggerFunction = function(message){
            console.log(
                '%c '+label+': %c '+message + ' ',
                'background-color: '+lBGColor+';color: '+lTxtColor+'; font-weight:bold;',
                'background-color: '+mBGColor+';color: '+mTxtColor+';'
            ); 
        };
        return function(){
            if('TAS'===key || config.logging[key]){
               dataLogger(coloredLoggerFunction,function(m){console.log(m);},_.toArray(arguments)); 
            }
        };
    },
    logDebug  = colorLog(loggingSettings.debug),
    logError  = colorLog(loggingSettings.error),
    logWarn   = colorLog(loggingSettings.warn),
    logInfo   = colorLog(loggingSettings.info),
    logNotice = colorLog(loggingSettings.notice),
    logLog    = colorLog(loggingSettings.log),
    log       = colorLog(loggingSettings.TAS),
    logCS     = colorLog(loggingSettings.callstack),
    logCSA    = colorLog(loggingSettings.callstack_async),
    registerCallstack = function(callstack,label){
        var idx=_.findIndex(callstackRegistry,function(o){
            return (_.difference(o.stack,callstack).length === _.difference(callstack,o.stack).length) &&
                _.difference(o.stack,callstack).length === 0 &&
                o.label === label;
        });
        if(-1 === idx){
            idx=callstackRegistry.length;
            callstackRegistry.push({
                stack: callstack,
                label: label
            });
        }
        return idx;
    },
    setConfigOption = function(options){
        var newconf =_.defaults(options,config);
        newconf.logging=_.defaults(
            (options && options.logging)||{},
            config.logging
        );
        config=newconf;
    },
    
    debugMode = function(){
        config.logging.debug=true;
        config.debugMode = true;
    },
    getCallstack = function(){
        var e = new Error('dummy'),
            stack = _.map(_.rest(e.stack.replace(/^[^\(]+?[\n$]/gm, '')
            .replace(/^\s+at\s+/gm, '')
            .replace(/^Object.<anonymous>\s*\(/gm, '{anonymous}()@')
            .split('\n')),function(l){
                return l.replace(/\s+.*$/,'');
            });
        return stack;
    },
    logCallstackSub = function(cs){
        var matches, csa;
        _.find(cs,function(line){
            matches = line.match(/TAS_CALLSTACK_(\d+)/);
            if(matches){
               csa=callstackRegistry[matches[1]];
               logCSA( '===================='+(csa.label ? '> '+csa.label+' <' : '')+'====================');
               logCallstackSub(csa.stack);
               return true;
            } 
            logCS(line);
            return false;
        });
    },
    logCallstack = function(){
        var cs;
        if(config.debugMode){
            cs = getCallstack();
            cs.shift();
            log('==============================> CALLSTACK <==============================');
            logCallstackSub(cs);
            log('=========================================================================');
        }
    },
    wrapCallback = function (label, callback, context){
        var callstack;
        if('function' === typeof label){
            context=callback;
            callback=label;
            label=undefined;
        }
        if(!config.debugMode){
            return (function(cb,ctx){
                return function(){
                    cb.apply(ctx||{},arguments);
                };
            }(callback,context));
        }
        
        callstack = getCallstack();
        callstack.shift();
        
        return (function(cb,ctx,cs,lbl){
            var ctxref=registerCallstack(cs,lbl);
            /*jshint -W054 */
            return new Function('cb','ctx','TASlog',
                "return function TAS_CALLSTACK_"+ctxref+"(){"+
                    "TASlog('Entering: '+(cb.name||'(anonymous function)'));"+
                    "cb.apply(ctx||{},arguments);"+
                    "TASlog('Exiting: '+(cb.name||'(anonymous function)'));"+
                "};")(cb,ctx,log);
            /*jshint +W054 */
        }(callback,context,callstack,label));
    },
    prepareUpdate = function( attribute, value ){
        queuedUpdates[attribute]=value;
    },
    applyQueuedUpdates = function() {
      setAttrs(queuedUpdates);
      queuedUpdates = {};
    },
	namesFromArgs = function(args,base){
        return _.chain(args)
            .reduce(function(memo,attr){
                if('string' === typeof attr) {
                    memo.push(attr);
                } else if(_.isArray(args) || _.isArguments(args)){
                    memo = namesFromArgs(attr,memo);
                }
                return memo;
            },(_.isArray(base) && base) || [])
            .uniq()
            .value();
	},
	addId = function(obj,value){
		Object.defineProperty(obj,'id',{
			value: value,
			writeable: false,
			enumerable: false
		});
	},
	addProp = function(obj,prop,value,fullname){
		(function(){
            var pname=(_.contains(['S','F','I','D'],prop) ? '_'+prop : prop),
			    full_pname = fullname || prop,
                pvalue=value;
            _.each(['S','I','F'],function(p){
                if( !_.has(obj,p)){
                    Object.defineProperty(obj, p, {
                        value: {},
                        enumerable: false,
                        readonly: true
                    });
                }
            });
            if( !_.has(obj,'D')){
                Object.defineProperty(obj, 'D', {
                    value: _.reduce(_.range(10),function(m,d){
                            Object.defineProperty(m, d, {
                                value: {},
                                enumerable: true,
                                readonly: true
                            });
                            return m;
                        },{}),
                    enumerable: false,
                    readonly: true
                });
            }
            // Raw value
			Object.defineProperty(obj, pname, {
                enumerable: true,
				set: function(v){
                    if(v!==pvalue) {
                        pvalue=v;
                        prepareUpdate(full_pname,v);
                    }
				},
				get: function(){
					return pvalue;
				}
			});
            
            // string value
			Object.defineProperty(obj.S, pname, {
                enumerable: true,
				set: function(v){
                    var val=v.toString();
                    if(val !== pvalue) {
                        pvalue=val;
                        prepareUpdate(full_pname,val);
                    }
				},
				get: function(){
					return pvalue.toString();
				}
			});
            // int value
			Object.defineProperty(obj.I, pname, {
                enumerable: true,
				set: function(v){
                    var val=parseInt(v,10) || 0;
                    if(val !== pvalue){
                        pvalue=val;
                        prepareUpdate(full_pname,val);
                    }
				},
				get: function(){
					return parseInt(pvalue,10) || 0;
				}
			});
            // float value
			Object.defineProperty(obj.F, pname, {
                enumerable: true,
				set: function(v){
                    var val=parseFloat(v) || 0;
                    if(val !== pvalue) {
                        pvalue=val;
                        prepareUpdate(full_pname,val);
                    }
				},
				get: function(){
					return parseFloat(pvalue) || 0;
				}
			});
            _.each(_.range(10),function(d){
                Object.defineProperty(obj.D[d], pname, {
                    enumerable: true,
                    set: function(v){
                        var val=(parseFloat(v) || 0).toFixed(d);
                        if(val !== pvalue){
                            pvalue=val;
                            prepareUpdate(full_pname,val);
                        }
                    },
                    get: function(){
                        return (parseFloat(pvalue) || 0).toFixed(d);
                    }
                });
            });
		}());
	},
	
	repeating = function( section ) {
		return (function(s){
			var sectionName = s,
				attrNames = [],
				fieldNames = [],
				operations = [],
                after = [],
			
			repAttrs = function TAS_Repeating_Attrs(){
				attrNames = namesFromArgs(arguments,attrNames);
				return this;
			},
			repFields = function TAS_Repeating_Fields(){
				fieldNames = namesFromArgs(arguments,fieldNames);
				return this;
			},
			repReduce = function TAS_Repeating_Reduce(func, initial, final, context) { 
				operations.push({
                    type: 'reduce',
                    func: (func && _.isFunction(func) && func) || _.noop,
                    memo: (_.isUndefined(initial) && 0) || initial,
                    final: (final && _.isFunction(final) && final) || _.noop,
                    context: context || {}
                });
				return this;
			},
			repMap = function TAS_Repeating_Map(func, final, context) {
				operations.push({
                    type: 'map',
                    func: (func && _.isFunction(func) && func) || _.noop,
                    final: (final && _.isFunction(final) && final) || _.noop,
                    context: context || {}
                });
				return this;
			},
            repEach = function TAS_Repeating_Each(func, final, context) {
				operations.push({
                    type: 'each',
                    func: (func && _.isFunction(func) && func) || _.noop,
                    final: (final && _.isFunction(final) && final) || _.noop,
                    context: context || {}
                });
				return this;
            },
            repTap = function TAS_Repeating_Tap(final, context) {
				operations.push({
                    type: 'tap',
                    final: (final && _.isFunction(final) && final) || _.noop,
                    context: context || {}
                });
				return this;
            },
            repAfter = function TAS_Repeating_After(callback,context) {
				after.push({
                    callback: (callback && _.isFunction(callback) && callback) || _.noop,
                    context: context || {}
                });
				return this;
            },
			repExecute = function TAS_Repeating_Execute(callback,context){
				var rowSet = {},
					attrSet = {},
					fieldIds = [],
					fullFieldNames = [];
                repAfter(callback,context);
				// call each operation per row.
				// call each operation's final
				getSectionIDs("repeating_"+sectionName,function(ids){
					fieldIds = ids;
					fullFieldNames = _.reduce(fieldIds,function(memo,id){
						return memo.concat(_.map(fieldNames,function(name){
							return 'repeating_'+sectionName+'_'+id+'_'+name;  
						}));
					},[]);
					getAttrs( _.uniq(attrNames.concat(fullFieldNames)), function(values){
						_.each(attrNames,function(aname){
							if(values.hasOwnProperty(aname)){
								addProp(attrSet,aname,values[aname]);
							}
						});
						rowSet = _.reduce(fieldIds,function(memo,id){
							var r={};
							addId(r,id);
							_.each(fieldNames,function(name){
								var fn = 'repeating_'+sectionName+'_'+id+'_'+name;  
								addProp(r,name,values[fn],fn);
							});
							memo[id]=r;
							return memo;
						},{});
                        _.each(operations,function(op){
                            var res;
                            switch(op.type){
                                case 'tap':
                                    _.bind(op.final,op.context,rowSet,attrSet)();
                                    break;
                                case 'each':
                                    _.each(rowSet,function(r){
                                        _.bind(op.func,op.context,r,attrSet,r.id,rowSet)();
                                    });
                                    _.bind(op.final,op.context,rowSet,attrSet)();
                                    break;
                                case 'map':
                                    res = _.map(rowSet,function(r){
                                        return _.bind(op.func,op.context,r,attrSet,r.id,rowSet)();
                                    });
                                    _.bind(op.final,op.context,res,rowSet,attrSet)();
                                    break;
                                case 'reduce':
                                    res = op.memo;
                                    _.each(rowSet,function(r){
                                        res = _.bind(op.func,op.context,res,r,attrSet,r.id,rowSet)();
                                    });
                                    _.bind(op.final,op.context,res,rowSet,attrSet)();
                                    break;
                            }
                        });
                        // finalize attrs
                        applyQueuedUpdates();
                        _.each(after,function(op){
                            _.bind(op.callback,op.context)();
                        });
					});
				});
			};
				
			return {
				attrs: repAttrs,
				attr: repAttrs,
				column: repFields,
				columns: repFields,
				field: repFields,
				fields: repFields,
				reduce: repReduce,
				inject: repReduce,
				foldl: repReduce,
				map: repMap,
				collect: repMap,
				each: repEach,
                forEach: repEach,
                tap: repTap,
                'do': repTap,
				after: repAfter,
				last: repAfter,
				done: repAfter,
				execute: repExecute,
				go: repExecute,
				run: repExecute
			};
		}(section));
	},
    repeatingSimpleSum = function(section, field, destination){
        repeating(section)
            .attr(destination)
            .field(field)
            .reduce(function(m,r){
                return m + (r.F[field]);
            },0,function(t,r,a){
                a.S[destination]=t;
            })
            .execute();
    };
	console.log('%c.¸¸.*´¨`*.¸¸.*´¨`*.¸  The Aaron Sheet  v'+version+'  ¸.*´¨`*.¸¸.*´¨`*.¸¸.','background: linear-gradient(to right,green,white,white,green); color:black;text-shadow: 0 0 8px white;');
	console.log('%c.¸¸.*´¨`*.¸¸.*´¨`*.¸  Last update: '+(new Date(lastUpdate*1000))+'  ¸.*´¨`*.¸¸.*´¨`*.¸¸.','background: linear-gradient(to right,green,white,white,green); color:black;text-shadow: 0 0 8px white;');
    return {
        /* Repeating Sections */
        repeatingSimpleSum: repeatingSimpleSum,
		repeating: repeating,
        /* Configuration */
        config: setConfigOption,
        /* Debugging */
        callback: wrapCallback,
        callstack: logCallstack,
        debugMode: debugMode,
        _fn: wrapCallback,
        /* Logging */
        debug: logDebug,
        error: logError,
        warn: logWarn,
        info: logInfo,
        notice: logNotice,
        log: logLog
    };
}());


        on("sheet:opened change:type1 change:type2", function() {
            getAttrs(["type1", "type2"], function(values) {
                setAttrs({
                    typeDamageMod: (values.type1 == 'Attaque' ? 1 : 0) + (values.type2 == 'Attaque' ? 1 : 0),
                    typeInitiativeMod: (values.type1 == 'Technique' ? 1 : 0) + (values.type2 == 'Technique' ? 1 : 0),
                    ConcentrationMod: (values.type1 == 'Technique' ? 1 : 0) + (values.type2 == 'Technique' ? 1 : 0),
                    TypeEncMod: (values.type1 == 'Technique' ? 3 : 0) + (values.type2 == 'Technique' ? 3 : 0),
                    TypePVMod: (values.type1 == 'Attaque' ? 4 : 0) + (values.type2 == 'Attaque' ? 4 : 0),
                    TypePEMod: (values.type1 == 'Magie' ? 4 : 0) + (values.type2 == 'Magie' ? 4 : 0),
                    showAttackTypeMastery: (values.type1 == 'Attaque' || values.type2 == 'Attaque' ? 1 : 0),
                    showSecondAttackTypeMastery: (values.type1 == 'Attaque' && values.type2 == 'Attaque' ? 1 : 0),
                    affMagie2: (values.type2 == 'Magie' ? 1 : 0)
                });
            });
        });
        
        on("sheet:opened change:showAttackTypeMastery", function() {
            getAttrs(["showAttackTypeMastery"], function(values) {
                if (parseInt(values.showAttackTypeMastery) == 0) {
                    setAttrs({
                        attackTypeMastery: 0 
                    });
                }
            });
        });
        
        on("sheet:opened change:showSecondAttackTypeMastery", function() {
            getAttrs(["showSecondAttackTypeMastery"], function(values) {
                if (parseInt(values.showSecondAttackTypeMastery) == 0) {
                    setAttrs({
                        attackTypeMastery2: 0 
                    });
                }
            });
        });
        
        on("sheet:opened change:classe1 change:classe2", function() {
            getAttrs(["classe1", "classe2"], function(values) {
                setAttrs({
                    classeTravelMod: (values.classe1 == "Ménestrel" ? 1 : 0) + (values.classe2 == "Ménestrel" ? 1 : 0),
                    classeDirectionMod: (values.classe1 == "Ménestrel" ? 1 : 0) + (values.classe2 == "Ménestrel" ? 1 : 0) + (values.classe1 == "Navigateur" ? 2 : 0) + (values.classe2 == "Navigateur" ? 2 : 0) - (values.classe1 == "Navigateur" && values.classe2 == "Navigateur" ? 1 : 0),
                    classeCampMod: (values.classe1 == "Ménestrel" ? 1 : 0) + (values.classe2 == "Ménestrel" ? 1 : 0),
                    classeNegotiationMod: (values.classe1 == "Marchand" ? 1 : 0) + (values.classe2 == "Marchand" ? 1 : 0),
                    classeEncMod: (values.classe1 == "Fermier" ? 3 : 0) + (values.classe2 == "Fermier" ? 3 : 0),
                    classeConditionMod: (values.classe1 == "Fermier" ? 1 : 0) + (values.classe2 == "Fermier" ? 1 : 0),
                    showArtisanSkills: (values.classe1 == "Artisan" || values.classe2 == "Artisan" ? 1 : 0),
                    showFarmerSkills: (values.classe1 == "Fermier" || values.classe2 == "Fermier" ? 1 : 0),
                    showHealerSkills: (values.classe1 == "Guérisseur" || values.classe2 == "Guérisseur" ? 1 : 0),
                    showHunterSkills: (values.classe1 == "Chasseur" || values.classe2 == "Chasseur" ? 1 : 0),
                    showNavigatorSkills: (values.classe1 == "Navigateur" || values.classe2 == "Navigateur" ? 1 : 0),
                    showMerchantSkills: (values.classe1 == "Marchand" || values.classe2 == "Marchand" ? 1 : 0),
                    showMinstrelSkills: (values.classe1 == "Ménestrel" || values.classe2 == "Ménestrel" ? 1 : 0),
                    showNobleSkills: (values.classe1 == "Noble" || values.classe2 == "Noble" ? 1 : 0),
                    showWeaponGrace: (values.classe1 == "Noble" || values.classe2 == "Noble" ? 1 : 0),
                    showSecondWeaponGrace: (values.classe1 == "Noble" && values.classe2 == "Noble" ? 1 : 0),
                    animalsmax: 1 + (values.classe1 == "Marchand" || values.classe1 == "Fermier" ? 2 : 0) + (values.classe2 == "Marchand" || values.classe2 == "Fermier" ? 2 : 0)
                });
            });
        });
        
        on("sheet:opened change:race change:currentSeason", function() {
            getAttrs(["race", "currentSeason"], function(values) {
                setAttrs({
                    RaceEncMod: (values.race == 2 ? 3 : 0),
                    BonusSaisonKoneko: (values.race == 2 && values.currentSeason == "Spring" ? 1 : 0),
                });
            });
        });
        
        
        on("sheet:opened change:speclimat1 change:speclimat2 change:rainMod change:hardRainMod change:darkMod change:hurricaneMod change:blizzardMod change:snowMod change:deepFogMod change:strongWindMod change:hotMod change:fogMod change:coldMod change:grasslandMod change:desertMod change:mountainMod change:jungleMod change:alpineMod change:wastelandMod change:woodsMod change:highlandsMod change:rockyTerrainMod change:deepForestMod change:swampMod", function() {
            getAttrs(["speclimat1", "speclimat2", "rainMod", "strongWindMod", "hardRainMod", "snowMod", "darkMod", "deepFogMod", "hurricaneMod", "blizzardMod", "fogMod", "coldMod", "hotMod", "grasslandMod", "wastelandMod", "mountainMod", "desertMod", "jungleMod", "alpineMod", "woodsMod", "highlandsMod", "rockyTerrainMod", "deepForestMod", "swampMod"], function(values) {
                setAttrs({
                    ModPlaine: (values.speclimat1 == "Plaine" ? 2 : 0) + (values.speclimat2 == "Plaine" ? 2 : 0) + parseInt(values["grasslandMod"]),
                    ModLande: (values.speclimat1 == "Lande" ? 2 : 0) + (values.speclimat2 == "Lande" ? 2 : 0) + parseInt(values["wastelandMod"]),
                    ModBois: (values.speclimat1 == "Bois" ? 2 : 0) + (values.speclimat2 == "Bois" ? 2 : 0) + parseInt(values["woodsMod"]),
                    ModColline: (values.speclimat1 == "Colline" ? 2 : 0) + (values.speclimat2 == "Colline" ? 2 : 0) + parseInt(values["highlandsMod"]),
                    ModRocaille: (values.speclimat1 == "Rocaille" ? 2 : 0) + (values.speclimat2 == "Rocaille" ? 2 : 0) + parseInt(values["rockyTerrainMod"]),
                    ModForet: (values.speclimat1 == "Foret" ? 2 : 0) + (values.speclimat2 == "Foret" ? 2 : 0) + parseInt(values["deepForestMod"]),
                    ModMarais: (values.speclimat1 == "Marais" ? 2 : 0) + (values.speclimat2 == "Marais" ? 2 : 0) + parseInt(values["swampMod"]),
                    ModMontagne: (values.speclimat1 == "Montagne" ? 2 : 0) + (values.speclimat2 == "Montagne" ? 2 : 0) + parseInt(values["mountainMod"]),
                    ModDesert: (values.speclimat1 == "Desert" ? 2 : 0) + (values.speclimat2 == "Desert" ? 2 : 0) + parseInt(values["desertMod"]),
                    ModJungle: (values.speclimat1 == "Jungle" ? 2 : 0) + (values.speclimat2 == "Jungle" ? 2 : 0) + parseInt(values["jungleMod"]),
                    ModHM: (values.speclimat1 == "HM" ? 2 : 0) + (values.speclimat2 == "HM" ? 2 : 0) + parseInt(values["alpineMod"]),
                    ModPluie: (values.speclimat1 == "Pluie" ? 2 : 0) + (values.speclimat2 == "Pluie" ? 2 : 0) + parseInt(values["rainMod"]),
                    ModVF: (values.speclimat1 == "VF" ? 2 : 0) + (values.speclimat2 == "VF" ? 2 : 0) + parseInt(values["strongWindMod"]),
                    ModBrume: (values.speclimat1 == "Brume" ? 2 : 0) + (values.speclimat2 == "Brume" ? 2 : 0) + parseInt(values["fogMod"]),
                    ModChaleur: (values.speclimat1 == "Chaleur" ? 2 : 0) + (values.speclimat2 == "Chaleur" ? 2 : 0) + parseInt(values["hotMod"]),
                    ModFroid: (values.speclimat1 == "Froid" ? 2 : 0) + (values.speclimat2 == "Froid" ? 2 : 0) + parseInt(values["coldMod"]),
                    ModOrage: (values.speclimat1 == "Orage" ? 2 : 0) + (values.speclimat2 == "Orage" ? 2 : 0) + parseInt(values["hardRainMod"]),
                    ModNeige: (values.speclimat1 == "Neige" ? 2 : 0) + (values.speclimat2 == "Neige" ? 2 : 0) + parseInt(values["snowMod"]),
                    ModBrouillard: (values.speclimat1 == "Brouillard" ? 2 : 0) + (values.speclimat2 == "Brouillard" ? 2 : 0) + parseInt(values["deepFogMod"]),
                    ModTempete: (values.speclimat1 == "Tempete" ? 2 : 0) + (values.speclimat2 == "Tempete" ? 2 : 0) + parseInt(values["hurricaneMod"]),
                    ModTenebres: (values.speclimat1 == "Tenebres" ? 2 : 0) + (values.speclimat2 == "Tenebres" ? 2 : 0) + parseInt(values["darkMod"]),
                    ModBlizzard: (values.speclimat1 == "Blizzard" ? 2 : 0) + (values.speclimat2 == "Blizzard" ? 2 : 0) + parseInt(values["blizzardMod"]),
                    });
            });
        });
        
        on("sheet:opened change:initialMastery change:attackTypeMastery change:attackTypeMastery2", function() {
            getAttrs(["initialMastery", "attackTypeMastery", "attackTypeMastery2"], function(values) {
                setAttrs({
                    MasteryLongue: (values.initialMastery == "2" || values.attackTypeMastery == "2" || values.attackTypeMastery2 == "2" ? 1 : 0),
                    MasteryLance: (values.initialMastery == "3" || values.attackTypeMastery == "3" || values.attackTypeMastery2 == "3" ? 1 : 0),
                    MasteryArc: (values.initialMastery == "5" || values.attackTypeMastery == "5" || values.attackTypeMastery2 == "5" ? 1 : 0),
                    });
            });
        });
        
        on("sheet:opened change:weaponGrace change:weaponGrace2", function() {
            getAttrs(["weaponGrace", "weaponGrace2"], function(values) {
                setAttrs({
                    GraceLongue: (values.weaponGrace == "2" || values.weaponGrace2 == "2" ? 1 : 0),
                    GraceLance: (values.weaponGrace == "3" || values.weaponGrace2 == "3" ? 1 : 0),
                    GraceArc: (values.weaponGrace == "5" || values.weaponGrace2 == "5" ? 1 : 0),
                    });
            });
        });
        
        on("sheet:opened change:Mastery1Longue", function() {
            getAttrs(["Mastery1Longue"], function(values) {
                if (parseInt(values.Mastery1Longue) > 1) {
                    setAttrs({
                        MasteryLongue: 1 
                    });
                }
                else {
                    setAttrs({
                        MasteryLongue: 0
                    });
        	    }
            });
        });
        
        on("sheet:opened change:Mastery1Lance", function() {
            getAttrs(["Mastery1Lance"], function(values) {
                if (parseInt(values.Mastery1Lance) > 1) {
                    setAttrs({
                        MasteryLance: 1 
                    });
                }
                else {
                    setAttrs({
                        MasteryLance: 0
                    });
        	    }
            });
        });
        
        on("sheet:opened change:Mastery1Arc", function() {
            getAttrs(["Mastery1Arc"], function(values) {
                if (parseInt(values.Mastery1Arc) > 1) {
                    setAttrs({
                        MasteryArc: 1 
                    });
                }
                else {
                    setAttrs({
                        MasteryArc: 0
                    });
        	    }
            });
        });
        
        on("sheet:opened change:XPtotal", function() {
            getAttrs(["XPtotal"], function(values) {
	            setAttrs({
	                Niveau: 1 + (values.XPtotal >= 100 ? 1 : 0) + (values.XPtotal >= 600 ? 1 : 0) + (values.XPtotal >= 1200 ? 1 : 0) + (values.XPtotal >= 2000 ? 1 : 0) + (values.XPtotal >= 3000 ? 1 : 0) + (values.XPtotal >= 4200 ? 1 : 0) + (values.XPtotal >= 5800 ? 1 : 0) + (values.XPtotal >= 7500 ? 1 : 0) + (values.XPtotal >= 10000 ? 1 : 0)
	            });
            });
        });
        
        on("sheet:opened change:Niveau", function() {
            getAttrs(["Niveau"], function(values) {
	            setAttrs({
	                affniv2: (values.Niveau >= 2 ? 1 : 0),
	                affniv3: (values.Niveau >= 3 ? 1 : 0),
	                affniv4: (values.Niveau >= 4 ? 1 : 0),
	                affniv5: (values.Niveau >= 5 ? 1 : 0),
	                affniv6: (values.Niveau >= 6 ? 1 : 0),
	                affniv7: (values.Niveau >= 7 ? 1 : 0),
	                affniv8: (values.Niveau >= 8 ? 1 : 0),
	                affniv9: (values.Niveau >= 9 ? 1 : 0),
	                affniv10: (values.Niveau >= 10 ? 1 : 0),
	            });
            });
        });
        
        on("sheet:opened change:Session", function() {
            getAttrs(["Session"], function(values) {
	            setAttrs({
	                NivDrag: 1 + (values.Session >= 1 ? 1 : 0) + (values.Session >= 3 ? 1 : 0) + (values.Session >= 7 ? 1 : 0) + (values.Session >= 12 ? 1 : 0)
	            });
            });
        });
        
        on("sheet:opened change:NivDrag", function() {
            getAttrs(["NivDrag"], function(values) {
	            setAttrs({
	                Vit5: (values.NivDrag >= 3 ? 2 : 0),
	                Vit10: (values.NivDrag >= 5 ? 5 : 0),
	            });
            });
        });
        
        on("sheet:opened change:NivDrag", function() {
            getAttrs(["NivDrag"], function(values) {
	            setAttrs({
	                affDragNiv2: (values.NivDrag >= 2 ? 1 : 0),
	                affDragNiv3: (values.NivDrag >= 3 ? 1 : 0),
	                affDragNiv4: (values.NivDrag >= 4 ? 1 : 0),
	                affDragNiv5: (values.NivDrag >= 5 ? 1 : 0),
	            });
            });
        });
        
        on("sheet:opened change:metierappoint", function() {
            getAttrs(["metierappoint"], function(values) {
	            setAttrs({
	                MACrea: (values.metierappoint == 1 ? 1 : 0),
	                MATrans: (values.metierappoint == 2 ? 1 : 0),
	                MARepa: (values.metierappoint == 3 ? 1 : 0),
	                MAChasse: (values.metierappoint == 4 ? 1 : 0),
	                MATraque: (values.metierappoint == 5 ? 1 : 0),
	                MAEli: (values.metierappoint == 6 ? 1 : 0),
	                MAHerbe: (values.metierappoint == 7 ? 1 : 0),
	                MASoins: (values.metierappoint == 8 ? 1 : 0),
	                MAComm: (values.metierappoint == 9 ? 1 : 0),
	                MALeg: (values.metierappoint == 10 ? 1 : 0),
	                MAMelo: (values.metierappoint == 11 ? 1 : 0),
	                MANavi: (values.metierappoint == 12 ? 1 : 0),
	                MAEru: (values.metierappoint == 13 ? 1 : 0),
	                MAEti: (values.metierappoint == 14 ? 1 : 0),
	            });
            });
        });
        
        on("sheet:opened change:typeobjetcreation", function() {
            getAttrs(["typeobjetcreation"], function(values) {
                setAttrs({
	                AffCrea: (values.typeobjetcreation == 1 ? 0 : 1),
	            });
            });
        });
        
        on("sheet:opened change:typeobjetcreation", function() {
            getAttrs(["typeobjetcreation"], function(values) {
                setAttrs({
	                AffCuis: (values.typeobjetcreation == 1 ? 1 : 0),
	            });
            });
        });
        
                
        on("sheet:opened change:typeobjetcreation2", function() {
            getAttrs(["typeobjetcreation2"], function(values) {
                setAttrs({
	                MAAffCrea: (values.typeobjetcreation2 == 1 ? 0 : 1),
	            });
            });
        });
        
        on("sheet:opened change:typeobjetcreation2", function() {
            getAttrs(["typeobjetcreation2"], function(values) {
                setAttrs({
	                MAAffCuis: (values.typeobjetcreation2 == 1 ? 1 : 0),
	            });
            });
        });
        
        on("sheet:opened change:MAAffCuis change:MAAffCrea change:metierappoint", function() {
            getAttrs(["MAAffCuis", "MAAffCrea", "metierappoint"], function(values) {
                setAttrs({
	                MAAffCuisT: (values.MAAffCuis == 1 && values.metierappoint == 1 ? 1 : 0),
	                MAAffCreaT: (values.MAAffCrea == 1 && values.metierappoint == 1 ? 1 : 0),
	            });
            });
        });
        
        on("sheet:opened change:EquipEncTotal change:ContenantEnc", function() {
            getAttrs(["EquipEncTotal", "ContenantEnc"], function(values) {
	            setAttrs({
	                Encomb: parseInt(values["EquipEncTotal"]) + parseInt(values["ContenantEnc"])
	            });
            });
        });
        
        on("change:repeating_arme",function(){
            TAS.repeatingSimpleSum("arme","armeEnc","armeEncTotal");
        });
        
        on("change:repeating_armure",function(){
            TAS.repeatingSimpleSum("armure","armureEnc","armureEncTotal");
        });
        
        on("change:repeating_equipement",function(){
            TAS.repeatingSimpleSum("equipement","EquipEnc","EquipEncTotal");
        });
        
        on("change:repeating_contenant",function(){
            TAS.repeatingSimpleSum("contenant","EquipConteEnc","EquipConteEncTotal");
        });
        
        
        
        on("change:repeating_equipanimal1",function(){
            TAS.repeatingSimpleSum("equipanimal1","EquipAnimal1Enc","EquipAnimal1EncTotal");
        });
        
        on("change:repeating_Contenant1animal1",function(){
            TAS.repeatingSimpleSum("Contenant1animal1","EquipAnimal1Contenant1Enc","EquipAnimal1Contenant1EncTotal");
        });
        
        on("change:repeating_Contenant2animal1",function(){
            TAS.repeatingSimpleSum("Contenant2animal1","EquipAnimal1Contenant2Enc","EquipAnimal1Contenant2EncTotal");
        });
        
        on("change:repeating_Contenant3animal1",function(){
            TAS.repeatingSimpleSum("Contenant3animal1","EquipAnimal1Contenant3Enc","EquipAnimal1Contenant3EncTotal");
        });
        
        on("change:repeating_equipanimal2",function(){
            TAS.repeatingSimpleSum("equipanimal2","Equipanimal2Enc","Equipanimal2EncTotal");
        });
        
        on("change:repeating_Contenant1animal2",function(){
            TAS.repeatingSimpleSum("Contenant1animal2","Equipanimal2Contenant1Enc","Equipanimal2Contenant1EncTotal");
        });
        
        on("change:repeating_Contenant2animal2",function(){
            TAS.repeatingSimpleSum("Contenant2animal2","Equipanimal2Contenant2Enc","Equipanimal2Contenant2EncTotal");
        });
        
        on("change:repeating_Contenant3animal2",function(){
            TAS.repeatingSimpleSum("Contenant3animal2","Equipanimal2Contenant3Enc","Equipanimal2Contenant3EncTotal");
        });
        
        on("change:repeating_equipanimal3",function(){
            TAS.repeatingSimpleSum("equipanimal3","Equipanimal3Enc","Equipanimal3EncTotal");
        });
        
        on("change:repeating_Contenant1animal3",function(){
            TAS.repeatingSimpleSum("Contenant1animal3","Equipanimal3Contenant1Enc","Equipanimal3Contenant1EncTotal");
        });
        
        on("change:repeating_Contenant2animal3",function(){
            TAS.repeatingSimpleSum("Contenant2animal3","Equipanimal3Contenant2Enc","Equipanimal3Contenant2EncTotal");
        });
        
        on("change:repeating_Contenant3animal3",function(){
            TAS.repeatingSimpleSum("Contenant3animal3","Equipanimal3Contenant3Enc","Equipanimal3Contenant3EncTotal");
        });
        
        on("change:repeating_equipanimal4",function(){
            TAS.repeatingSimpleSum("equipanimal4","Equipanimal4Enc","Equipanimal4EncTotal");
        });
        
        on("change:repeating_Contenant1animal4",function(){
            TAS.repeatingSimpleSum("Contenant1animal4","Equipanimal4Contenant1Enc","Equipanimal4Contenant1EncTotal");
        });
        
        on("change:repeating_Contenant2animal4",function(){
            TAS.repeatingSimpleSum("Contenant2animal4","Equipanimal4Contenant2Enc","Equipanimal4Contenant2EncTotal");
        });
        
        on("change:repeating_Contenant3animal4",function(){
            TAS.repeatingSimpleSum("Contenant3animal4","Equipanimal4Contenant3Enc","Equipanimal4Contenant3EncTotal");
        });
        
        on("change:repeating_equipanimal5",function(){
            TAS.repeatingSimpleSum("equipanimal5","Equipanimal5Enc","Equipanimal5EncTotal");
        });
        
        on("change:repeating_Contenant1animal5",function(){
            TAS.repeatingSimpleSum("Contenant1animal5","Equipanimal5Contenant1Enc","Equipanimal5Contenant1EncTotal");
        });
        
        on("change:repeating_Contenant2animal5",function(){
            TAS.repeatingSimpleSum("Contenant2animal5","Equipanimal5Contenant2Enc","Equipanimal5Contenant2EncTotal");
        });
        
        on("change:repeating_Contenant3animal5",function(){
            TAS.repeatingSimpleSum("Contenant3animal5","Equipanimal5Contenant3Enc","Equipanimal5Contenant3EncTotal");
        });
        
        
        on("sheet:opened change:VIG change:EncomMod change:attniv2 change:attniv4 change:attniv6 change:attniv8 change:attniv10 change:Niveau change:classeEncMod change:TypeEncMod change:RaceEncMod", function() {
            getAttrs(["VIG", "EncomMod", "attniv2", "attniv4", "attniv6", "attniv8", "attniv10", "Niveau", "classeEncMod", "TypeEncMod", "RaceEncMod"], function(values) {
	            setAttrs({
	                Encombmax: parseInt(values["VIG"]) + parseInt(values["EncomMod"]) + 3 + (values.attniv2 == 'VIG' ? 2 : 0) + (values.attniv4 == 'VIG' ? 2 : 0) + (values.attniv6 == 'VIG' ? 2 : 0) + (values.attniv8 == 'VIG' ? 2 : 0) + (values.attniv10 == 'VIG' ? 2 : 0) + (parseInt(values["Niveau"]) - 1) + parseInt(values["classeEncMod"]) + parseInt(values["TypeEncMod"]) + parseInt(values["RaceEncMod"])
	            });
            });
        });
        
        on("sheet:opened change:Encomb change:Encombmax", function() {
            getAttrs(["Encomb", "Encombmax"], function(values) {
	            setAttrs({
	                EncombCalcul: parseInt(values["Encombmax"]) - parseInt(values["Encomb"])
	            });
            });
        });   
        
        on("sheet:opened change:EncombCalcul", function() {
            getAttrs(["EncombCalcul"], function(values) {
                if (parseInt(values.EncombCalcul) > 0) {
                    setAttrs({
                        MalusEnc: 0 
                    });
                }
                if (parseInt(values.EncombCalcul) < 1) {
                    setAttrs({
                        MalusEnc: parseInt(values["EncombCalcul"])
                    });
        	    }
            });
        });
        
        on("sheet:opened change:showWeaponGrace", function() {
            getAttrs(["showWeaponGrace"], function(values) {
                if (parseInt(values.showWeaponGrace) == 0) {
                    setAttrs({
                        weaponGrace: 0 
                    });
                }
            });
        });
        
        on("sheet:opened change:showSecondWeaponGrace", function() {
            getAttrs(["showSecondWeaponGrace"], function(values) {
                if (parseInt(values.showSecondWeaponGrace) == 0) {
                    setAttrs({
                        weaponGrace2: 0 
                    });
                }
            });
        });

        on("sheet:opened change:Blesse change:condition", function() {
            getAttrs(["condition", "Blesse"], function(values) {
                setAttrs({
                    injured: parseInt(values.Blesse) > parseInt(values.condition) ? 2 : 0
                });
            });
        });
        
        on("sheet:opened change:Poison change:condition", function() {
            getAttrs(["condition", "Poison"], function(values) {
                setAttrs({
                    poisoned: parseInt(values.Poison) > parseInt(values.condition) ? 2 : 0
                });
            });
        });
        
        on("sheet:opened change:Malade change:condition", function() {
            getAttrs(["condition", "Malade"], function(values) {
                setAttrs({
                    sick: parseInt(values.Malade) > parseInt(values.condition) ? 2 : 0
                });
            });
        });
        
        on("sheet:opened change:Las change:condition", function() {
            getAttrs(["condition", "Las"], function(values) {
                setAttrs({
                    exhausted: parseInt(values.Las) > parseInt(values.condition) ? 2 : 0
                });
            });
        });
        
        on("sheet:opened change:Surex change:condition", function() {
            getAttrs(["condition", "Surex"], function(values) {
                setAttrs({
                    muddled: parseInt(values.Surex) > parseInt(values.condition) ? 2 : 0
                });
            });
        });
        
        on("sheet:opened change:Choc change:condition", function() {
            getAttrs(["condition", "Choc"], function(values) {
                setAttrs({
                    shocked: parseInt(values.Choc) > parseInt(values.condition) ? 2 : 0
                });
            });
        });
        
        on("sheet:opened change:VIG change:poisoned change:sick change:shocked change:bonus change:condition change:attniv2 change:attniv4 change:attniv6 change:attniv8 change:attniv10 change:SeuilCondition", function() {
            getAttrs(["VIG", "poisoned", "sick", "shocked", "bonus", "condition", "attniv2", "attniv4", "attniv6", "attniv8", "attniv10", "SeuilCondition"], function(values) {
                setAttrs({
                    VIGT: Math.min(12, Math.max(4, parseInt(values.VIG) - parseInt(values.poisoned) - parseInt(values.sick) - parseInt(values.shocked) + (values.bonus == 'VIG' && parseInt(values.condition) > parseInt(values.SeuilCondition) ? 2 : 0) + (values.attniv2 == 'VIG' ? 2 : 0) + (values.attniv4 == 'VIG' ? 2 : 0) + (values.attniv6 == 'VIG' ? 2 : 0) + (values.attniv8 == 'VIG' ? 2 : 0) + (values.attniv10 == 'VIG' ? 2 : 0)  ))
                });
            });
        });
        
        on("sheet:opened change:AGI change:injured change:sick change:shocked change:bonus change:condition change:attniv2 change:attniv4 change:attniv6 change:attniv8 change:attniv10", function() {
            getAttrs(["AGI", "injured", "sick", "shocked", "bonus", "condition", "attniv2", "attniv4", "attniv6", "attniv8", "attniv10"], function(values) {
                setAttrs({
                    AGIT: Math.min(12, Math.max(4, parseInt(values.AGI) - parseInt(values.injured) - parseInt(values.sick) - parseInt(values.shocked) + (values.bonus == 'AGI' && parseInt(values.condition) > parseInt(values.SeuilCondition) ? 2 : 0) + (values.attniv2 == 'AGI' ? 2 : 0) + (values.attniv4 == 'AGI' ? 2 : 0) + (values.attniv6 == 'AGI' ? 2 : 0) + (values.attniv8 == 'AGI' ? 2 : 0) + (values.attniv10 == 'AGI' ? 2 : 0)  ))
                });
            });
        });
        
        on("sheet:opened change:INT change:muddled change:sick change:shocked change:bonus change:condition change:attniv2 change:attniv4 change:attniv6 change:attniv8 change:attniv10", function() {
            getAttrs(["INT", "muddled", "sick", "shocked", "bonus", "condition", "attniv2", "attniv4", "attniv6", "attniv8", "attniv10"], function(values) {
                setAttrs({
                    INTT: Math.min(12, Math.max(4, parseInt(values.INT) - parseInt(values.muddled) - parseInt(values.sick) - parseInt(values.shocked) + (values.bonus == 'INT' && parseInt(values.condition) > parseInt(values.SeuilCondition) ? 2 : 0) + (values.attniv2 == 'INT' ? 2 : 0) + (values.attniv4 == 'INT' ? 2 : 0) + (values.attniv6 == 'INT' ? 2 : 0) + (values.attniv8 == 'INT' ? 2 : 0) + (values.attniv10 == 'INT' ? 2 : 0)  ))
                });
            });
        });
        
        on("sheet:opened change:ESP change:exhausted change:sick change:shocked change:bonus change:condition change:attniv2 change:attniv4 change:attniv6 change:attniv8 change:attniv10", function() {
            getAttrs(["ESP", "exhausted", "sick", "shocked", "bonus", "condition", "attniv2", "attniv4", "attniv6", "attniv8", "attniv10"], function(values) {
                setAttrs({
                    ESPT: Math.min(12, Math.max(4, parseInt(values.ESP) - parseInt(values.exhausted) - parseInt(values.sick) - parseInt(values.shocked) + (values.bonus == 'ESP' && parseInt(values.condition) > parseInt(values.SeuilCondition) ? 2 : 0) + (values.attniv2 == 'ESP' ? 2 : 0) + (values.attniv4 == 'ESP' ? 2 : 0) + (values.attniv6 == 'ESP' ? 2 : 0) + (values.attniv8 == 'ESP' ? 2 : 0) + (values.attniv10 == 'ESP' ? 2 : 0)  ))
                });
            });
        });


</script>

